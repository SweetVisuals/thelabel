{"version":3,"file":"jcanvas-handles.min.js","sources":["../../src/jcanvas-handles.ts"],"sourcesContent":["/**\n * @license jCanvas Handles\n * Copyright 2015-2024 Caleb Evans\n * Released under the MIT license\n */\nimport $ from \"jquery\";\n\ninterface JCanvasLayerWithHandles extends JCanvasLayer {\n\thandlePlacement?: \"sides\" | \"corners\" | \"both\";\n\taspectRatio?: number | null;\n\thandle?: JCanvasLayer | null;\n\tguide?: JCanvasLayer | null;\n}\n\n// Add a 'resizeFromCenter' property for rectangles\n$.extend($.jCanvas.defaults, {\n\thandle: null,\n\tguide: null,\n\taspectRatio: null,\n\tresizeFromCenter: true,\n\tconstrainProportions: false,\n\thandlePlacement: \"corners\",\n\tminWidth: 0,\n\tminHeight: 0,\n} as Partial<JCanvasLayerWithHandles>);\n\n// Determines if the given layer is a rectangular layer\nfunction isRectLayer(layer: JCanvasLayerWithHandles) {\n\tconst method = layer._method;\n\treturn (\n\t\tmethod === $.fn.drawRect ||\n\t\tmethod === $.fn.drawEllipse ||\n\t\tmethod === $.fn.drawImage\n\t);\n}\n\n// Determines if the given layer is a rectangular layer\nfunction isPathLayer(layer: JCanvasLayerWithHandles) {\n\tconst method = layer._method;\n\treturn (\n\t\tmethod === $.fn.drawLine ||\n\t\tmethod === $.fn.drawQuadratic ||\n\t\tmethod === $.fn.drawBezier\n\t);\n}\n\n// Add a single handle to line path\nfunction addPathHandle(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tparent: JCanvasLayerWithHandles,\n\txProp: `x${number}` | `cx${number}`,\n\tyProp: `y${number}` | `cy${number}`\n) {\n\tconst handle = $.extend(\n\t\t{\n\t\t\tcursors: {\n\t\t\t\tmouseover: \"grab\",\n\t\t\t\tmousedown: \"grabbing\",\n\t\t\t\tmouseup: \"grab\",\n\t\t\t},\n\t\t},\n\t\tparent.handle,\n\t\t{\n\t\t\t// Define constant properties for handle\n\t\t\tlayer: true,\n\t\t\tdraggable: true,\n\t\t\tx: parent[xProp],\n\t\t\ty: parent[yProp],\n\t\t\t_parent: parent,\n\t\t\t_xProp: xProp,\n\t\t\t_yProp: yProp,\n\t\t\tfromCenter: true,\n\t\t\t// Adjust line path when dragging a handle\n\t\t\tdragstart: function (layer) {\n\t\t\t\t$(this).triggerLayerEvent(layer._parent, \"handlestart\");\n\t\t\t},\n\t\t\tdrag: function (layer) {\n\t\t\t\tconst parent = layer._parent;\n\t\t\t\tparent[layer._xProp] = layer.x - parent.x;\n\t\t\t\tparent[layer._yProp] = layer.y - parent.y;\n\t\t\t\tupdatePathGuides(parent);\n\t\t\t\t$(this).triggerLayerEvent(parent, \"handlemove\");\n\t\t\t},\n\t\t\tdragstop: function (layer) {\n\t\t\t\t$(this).triggerLayerEvent(layer._parent, \"handlestop\");\n\t\t\t},\n\t\t\tdragcancel: function (layer) {\n\t\t\t\t$(this).triggerLayerEvent(layer._parent, \"handlecancel\");\n\t\t\t},\n\t\t} as Partial<JCanvasLayerWithHandles>\n\t);\n\t$canvas.draw(handle);\n\t// Add handle to parent layer's list of handles\n\tparent._handles.push($canvas.getLayer(-1));\n}\n\n// Add a single handle to rectangle\nfunction addRectHandle(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tparent: JCanvasLayerWithHandles,\n\tpx: number,\n\tpy: number\n) {\n\tlet cursor;\n\n\t// Determine cursor to use depending on handle's placement\n\tif ((px === -1 && py === -1) || (px === 1 && py === 1)) {\n\t\tcursor = \"nwse-resize\";\n\t} else if (px === 0 && (py === -1 || py === 1)) {\n\t\tcursor = \"ns-resize\";\n\t} else if ((px === -1 || px === 1) && py === 0) {\n\t\tcursor = \"ew-resize\";\n\t} else if ((px === 1 && py === -1) || (px === -1 && py === 1)) {\n\t\tcursor = \"nesw-resize\";\n\t}\n\n\tconst nonNullWidth = parent.width || 0;\n\tconst nonNullHeight = parent.height || 0;\n\tconst handle = $.extend(\n\t\t{\n\t\t\t// Set cursors for handle\n\t\t\tcursors: {\n\t\t\t\tmouseover: cursor,\n\t\t\t},\n\t\t},\n\t\tparent.handle,\n\t\t{\n\t\t\t// Define constant properties for handle\n\t\t\tlayer: true,\n\t\t\tdraggable: true,\n\t\t\tx:\n\t\t\t\tparent.x +\n\t\t\t\t((px * nonNullWidth) / 2 + (parent.fromCenter ? 0 : nonNullWidth / 2)),\n\t\t\ty:\n\t\t\t\tparent.y +\n\t\t\t\t((py * nonNullHeight) / 2 +\n\t\t\t\t\t(parent.fromCenter ? 0 : nonNullHeight / 2)),\n\t\t\t_parent: parent,\n\t\t\t_px: px,\n\t\t\t_py: py,\n\t\t\tfromCenter: true,\n\t\t\tdragstart: function (layer) {\n\t\t\t\t$(this).triggerLayerEvent(layer._parent, \"handlestart\");\n\t\t\t},\n\t\t\t// Resize rectangle when dragging a handle\n\t\t\tdrag: function (layer) {\n\t\t\t\tconst parent = layer._parent;\n\n\t\t\t\tif (parent.width + layer.dx * layer._px < parent.minWidth) {\n\t\t\t\t\tparent.width = parent.minWidth;\n\t\t\t\t\tlayer.dx = 0;\n\t\t\t\t}\n\t\t\t\tif (parent.height + layer.dy * layer._py < parent.minHeight) {\n\t\t\t\t\tparent.height = parent.minHeight;\n\t\t\t\t\tlayer.dy = 0;\n\t\t\t\t}\n\n\t\t\t\tif (!parent.resizeFromCenter) {\n\t\t\t\t\t// Optionally constrain proportions\n\t\t\t\t\tif (parent.constrainProportions) {\n\t\t\t\t\t\tif (layer._py === 0) {\n\t\t\t\t\t\t\t// Manage handles whose y is at layer's center\n\t\t\t\t\t\t\tparent.height = parent.width / parent.aspectRatio;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Manage every other handle\n\t\t\t\t\t\t\tparent.width = parent.height * parent.aspectRatio;\n\t\t\t\t\t\t\tlayer.dx = layer.dy * parent.aspectRatio * layer._py * layer._px;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Optionally resize rectangle from corner\n\t\t\t\t\tif (parent.fromCenter) {\n\t\t\t\t\t\tparent.width += layer.dx * layer._px;\n\t\t\t\t\t\tparent.height += layer.dy * layer._py;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// This is simplified version based on math. Also you can write this using an if statement for each handle\n\t\t\t\t\t\tparent.width += layer.dx * layer._px;\n\t\t\t\t\t\tif (layer._px !== 0) {\n\t\t\t\t\t\t\tparent.x +=\n\t\t\t\t\t\t\t\tlayer.dx *\n\t\t\t\t\t\t\t\t(1 - layer._px && (1 - layer._px) / Math.abs(1 - layer._px));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparent.height += layer.dy * layer._py;\n\t\t\t\t\t\tif (layer._py !== 0) {\n\t\t\t\t\t\t\tparent.y +=\n\t\t\t\t\t\t\t\tlayer.dy *\n\t\t\t\t\t\t\t\t(1 - layer._py && (1 - layer._py) / Math.abs(1 - layer._py));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Ensure diagonal handle does not move\n\t\t\t\t\tif (parent.fromCenter) {\n\t\t\t\t\t\tif (layer._px !== 0) {\n\t\t\t\t\t\t\tparent.x += layer.dx / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (layer._py !== 0) {\n\t\t\t\t\t\t\tparent.y += layer.dy / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Otherwise, resize rectangle from center\n\t\t\t\t\tparent.width += layer.dx * layer._px * 2;\n\t\t\t\t\tparent.height += layer.dy * layer._py * 2;\n\t\t\t\t\t// Optionally constrain proportions\n\t\t\t\t\tif (parent.constrainProportions) {\n\t\t\t\t\t\tif (layer._py === 0) {\n\t\t\t\t\t\t\t// Manage handles whose y is at layer's center\n\t\t\t\t\t\t\tparent.height = parent.width / parent.aspectRatio;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Manage every other handle\n\t\t\t\t\t\t\tparent.width = parent.height * parent.aspectRatio;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tupdateRectHandles(parent);\n\t\t\t\t$(this).triggerLayerEvent(parent, \"handlemove\");\n\t\t\t},\n\t\t\tdragstop: function (layer) {\n\t\t\t\tconst parent = layer._parent;\n\t\t\t\t$(this).triggerLayerEvent(parent, \"handlestop\");\n\t\t\t},\n\t\t\tdragcancel: function (layer) {\n\t\t\t\tconst parent = layer._parent;\n\t\t\t\t$(this).triggerLayerEvent(parent, \"handlecancel\");\n\t\t\t},\n\t\t} as Partial<JCanvasLayerWithHandles>\n\t);\n\t$canvas.draw(handle);\n\t// Add handle to parent layer's list of handles\n\tparent._handles.push($canvas.getLayer(-1));\n}\n\n// Add all handles to rectangle\nfunction addRectHandles(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tparent: JCanvasLayerWithHandles\n) {\n\tconst handlePlacement = parent.handlePlacement;\n\tconst nonNullWidth = parent.width || 0;\n\tconst nonNullHeight = parent.height || 0;\n\t// Store current width-to-height ratio\n\tif (parent.aspectRatio === null && parent.height !== 0) {\n\t\tparent.aspectRatio = nonNullWidth / nonNullHeight;\n\t}\n\t// Optionally add handles to corners\n\tif (handlePlacement === \"corners\" || handlePlacement === \"both\") {\n\t\taddRectHandle($canvas, parent, -1, -1);\n\t\taddRectHandle($canvas, parent, 1, -1);\n\t\taddRectHandle($canvas, parent, 1, 1);\n\t\taddRectHandle($canvas, parent, -1, 1);\n\t}\n\t// Optionally add handles to sides\n\tif (handlePlacement === \"sides\" || handlePlacement === \"both\") {\n\t\taddRectHandle($canvas, parent, 0, -1);\n\t\taddRectHandle($canvas, parent, 1, 0);\n\t\taddRectHandle($canvas, parent, 0, 1);\n\t\taddRectHandle($canvas, parent, -1, 0);\n\t}\n\t// Optionally add handle guides\n\tif (parent.guide) {\n\t\taddRectGuides($canvas, parent);\n\t}\n}\n\n// Update handle guides for rectangular layer\nfunction updateRectGuides(parent: JCanvasLayerWithHandles) {\n\tconst guide = parent._guide;\n\tif (guide) {\n\t\tguide.x = parent.x;\n\t\tguide.y = parent.y;\n\t\tguide.width = parent.width;\n\t\tguide.height = parent.height;\n\t\tguide.fromCenter = parent.fromCenter;\n\t}\n}\n\n// Add handle guides to rectangular layer\nfunction addRectGuides(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tparent: JCanvasLayerWithHandles\n) {\n\tconst guideProps = $.extend({}, parent.guide, {\n\t\tlayer: true,\n\t\tdraggable: false,\n\t\ttype: \"rectangle\",\n\t\thandle: null,\n\t});\n\t$canvas.addLayer(guideProps);\n\tconst guide = $canvas.getLayer(-1);\n\tparent._guide = guide;\n\t$canvas.moveLayer(guide, -parent._handles.length - 1);\n\tupdateRectGuides(parent);\n}\n\n// Add handles to line path\nfunction addPathHandles(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tparent: JCanvasLayerWithHandles\n) {\n\tfor (const key in parent) {\n\t\tif (Object.prototype.hasOwnProperty.call(parent, key)) {\n\t\t\t// If property is a control point\n\t\t\tif (key.match(/c?x(\\d+)/gi) !== null) {\n\t\t\t\t// Get the x and y coordinates for that control point\n\t\t\t\tconst xProp = key as `x${number}` | `cx${number}`;\n\t\t\t\tconst yProp = key.replace(\"x\", \"y\") as `y${number}` | `cy${number}`;\n\t\t\t\t// Add handle at control point\n\t\t\t\taddPathHandle($canvas, parent, xProp, yProp);\n\t\t\t}\n\t\t}\n\t}\n\t// Add guides connecting handles\n\tif (parent.guide) {\n\t\taddPathGuides($canvas, parent);\n\t}\n}\n\n// Update handle guides for line path\nfunction updatePathGuides(parent: JCanvasLayerWithHandles) {\n\tlet handles = parent._handles;\n\tconst guides = parent._guides;\n\n\tif (parent._method === $.fn.drawQuadratic) {\n\t\tif (handles) {\n\t\t\tconst guide = parent._guide;\n\t\t\tif (guide) {\n\t\t\t\tfor (let h = 0; h < handles.length; h += 1) {\n\t\t\t\t\tconst handle = parent._handles[h];\n\t\t\t\t\tguide[\"x\" + (h + 1)] = handle.x;\n\t\t\t\t\tguide[\"y\" + (h + 1)] = handle.y;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (parent._method === $.fn.drawBezier) {\n\t\tif (guides) {\n\t\t\tfor (let g = 0; g < guides.length; g += 1) {\n\t\t\t\tconst guide = guides[g];\n\t\t\t\thandles = guide._handles;\n\t\t\t\tif (guide && handles) {\n\t\t\t\t\tfor (let h = 0; h < handles.length; h += 1) {\n\t\t\t\t\t\tconst handle = handles[h];\n\t\t\t\t\t\tguide[\"x\" + (h + 1)] = handle.x;\n\t\t\t\t\t\tguide[\"y\" + (h + 1)] = handle.y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n// Add guides to path layer\nfunction addPathGuides(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tparent: JCanvasLayerWithHandles\n) {\n\tconst handles = parent._handles;\n\tconst guideProps = $.extend({}, parent.guide, {\n\t\tlayer: true,\n\t\tdraggable: false,\n\t\ttype: \"line\",\n\t});\n\tif (parent._method === $.fn.drawQuadratic) {\n\t\t$canvas.addLayer(guideProps);\n\t\tparent._guide = $canvas.getLayer(-1);\n\t\t$canvas.moveLayer(parent._guide, -handles.length - 1);\n\t} else if (parent._method === $.fn.drawBezier) {\n\t\tparent._guides = [];\n\t\tfor (let h = 0; h < handles.length; h += 1) {\n\t\t\tconst handle = handles[h];\n\t\t\tconst nextHandle = handles[h + 1];\n\t\t\tconst prevHandle = handles[h - 1];\n\t\t\tlet otherHandle = null;\n\t\t\tif (nextHandle !== undefined) {\n\t\t\t\t// If handle is a start/end point and next handle is a control point\n\t\t\t\tif (\n\t\t\t\t\thandle._xProp.indexOf(\"x\") === 0 &&\n\t\t\t\t\tnextHandle._xProp.indexOf(\"cx\") === 0\n\t\t\t\t) {\n\t\t\t\t\totherHandle = nextHandle;\n\t\t\t\t}\n\t\t\t} else if (prevHandle !== undefined) {\n\t\t\t\tif (\n\t\t\t\t\tprevHandle._xProp.indexOf(\"cx\") === 0 &&\n\t\t\t\t\thandle._xProp.indexOf(\"x\") === 0\n\t\t\t\t) {\n\t\t\t\t\totherHandle = prevHandle;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (otherHandle !== null) {\n\t\t\t\t$canvas.addLayer(guideProps);\n\t\t\t\tconst guide = $canvas.getLayer(-1);\n\t\t\t\tif (guide) {\n\t\t\t\t\tguide._handles = [handle, otherHandle];\n\t\t\t\t\tparent._guides.push(guide);\n\t\t\t\t\t$canvas.moveLayer(guide, -handles.length - 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tupdatePathGuides(parent);\n}\n\n// Update position of handles according to\n// size and dimensions of rectangular layer\nfunction updateRectHandles(parent: JCanvasLayerWithHandles) {\n\tconst nonNullWidth = parent.width || 0;\n\tconst nonNullHeight = parent.height || 0;\n\tif (parent._handles) {\n\t\t// Move handles when dragging\n\t\tfor (let h = 0; h < parent._handles.length; h += 1) {\n\t\t\tconst handle = parent._handles[h];\n\t\t\thandle.x =\n\t\t\t\tparent.x +\n\t\t\t\t((nonNullWidth / 2) * handle._px +\n\t\t\t\t\t(parent.fromCenter ? 0 : nonNullWidth / 2));\n\t\t\thandle.y =\n\t\t\t\tparent.y +\n\t\t\t\t((nonNullHeight / 2) * handle._py +\n\t\t\t\t\t(parent.fromCenter ? 0 : nonNullHeight / 2));\n\t\t}\n\t}\n\tupdateRectGuides(parent);\n}\n\n// Update position of handles according to\n// coordinates and dimensions of path layer\nfunction updatePathHandles(parent: JCanvasLayerWithHandles) {\n\tconst handles = parent._handles;\n\tif (handles) {\n\t\t// Move handles when dragging\n\t\tfor (let h = 0; h < handles.length; h += 1) {\n\t\t\tconst handle = handles[h];\n\t\t\thandle.x = parent[handle._xProp] + parent.x;\n\t\t\thandle.y = parent[handle._yProp] + parent.y;\n\t\t}\n\t}\n\tupdatePathGuides(parent);\n}\n\n// Add drag handles to all four corners of rectangle layer\nfunction addHandles(parent: JCanvasLayerWithHandles) {\n\tconst $canvas = $(parent.canvas);\n\n\t// If parent's list of handles doesn't exist\n\tif (parent._handles === undefined) {\n\t\t// Create list to store handles\n\t\tparent._handles = [];\n\t}\n\n\tif (isRectLayer(parent)) {\n\t\t// Add four handles to corners of a rectangle/ellipse/image\n\t\taddRectHandles($canvas, parent);\n\t} else if (isPathLayer(parent)) {\n\t\t// Add two or more handles to a line path\n\t\taddPathHandles($canvas, parent);\n\t}\n}\n\n// Remove handles if handle property was removed\nfunction removeHandles(layer: JCanvasLayerWithHandles) {\n\tconst $canvas = $(layer.canvas);\n\tif (layer._handles) {\n\t\t// Remove handles from layer\n\t\tfor (let h = 0; h < layer._handles.length; h += 1) {\n\t\t\tconst handle = layer._handles[h];\n\t\t\t$canvas.removeLayer(handle);\n\t\t}\n\t\tlayer._handles.length = 0;\n\t}\n}\n\nfunction objectContainsPathCoords(obj: object) {\n\tfor (const prop in obj) {\n\t\tif (\n\t\t\tObject.prototype.hasOwnProperty.call(obj, prop) &&\n\t\t\tprop.match(/^(x|y)\\d+$/)\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\n$.extend($.jCanvas.eventHooks, {\n\t// If necessary, add handles when layer is added\n\tadd: function (layer: JCanvasLayerWithHandles) {\n\t\tif (layer.handle) {\n\t\t\taddHandles(layer);\n\t\t}\n\t},\n\t// Remove handles of layer is removed\n\tremove: function (layer) {\n\t\tif (layer._handles) {\n\t\t\tconst $canvas = $(this);\n\t\t\t// Remove handles from layer\n\t\t\tfor (let h = 0; h < layer._handles.length; h += 1) {\n\t\t\t\tconst handle = layer._handles[h];\n\t\t\t\t$canvas.removeLayer(handle);\n\t\t\t}\n\t\t\tlayer._handles.length = 0;\n\t\t}\n\t},\n\t// Update handle positions when changing parent layer's dimensions\n\tchange: function (layer, props: Partial<JCanvasLayerWithHandles>) {\n\t\tif (props.handle || objectContainsPathCoords(props)) {\n\t\t\t// Add handles if handle property was added\n\t\t\tremoveHandles(layer);\n\t\t\taddHandles(layer);\n\t\t} else if (props.handle === null) {\n\t\t\tremoveHandles(layer);\n\t\t}\n\t\tif (isRectLayer(layer)) {\n\t\t\t// If width/height was changed\n\t\t\tif (\n\t\t\t\tprops.width !== undefined ||\n\t\t\t\tprops.height !== undefined ||\n\t\t\t\tprops.x !== undefined ||\n\t\t\t\tprops.y !== undefined\n\t\t\t) {\n\t\t\t\t// Update handle positions\n\t\t\t\tupdateRectHandles(layer);\n\t\t\t}\n\t\t} else if (isPathLayer(layer)) {\n\t\t\tupdatePathHandles(layer);\n\t\t}\n\t},\n\t// Update handle positions when animating parent layer\n\tanimate: function (layer, fx: any) {\n\t\t// If layer is a rectangle or ellipse layer\n\t\tif (isRectLayer(layer)) {\n\t\t\t// If width or height are animated\n\t\t\tif (\n\t\t\t\tfx.prop === \"width\" ||\n\t\t\t\tfx.prop === \"height\" ||\n\t\t\t\tfx.prop === \"x\" ||\n\t\t\t\tfx.prop === \"y\"\n\t\t\t) {\n\t\t\t\t// Update rectangular handles\n\t\t\t\tupdateRectHandles(layer);\n\t\t\t}\n\t\t} else if (isPathLayer(layer)) {\n\t\t\t// If coordinates are animated\n\t\t\tif (fx.prop.match(/^c?(x|y)(\\d+)/gi) !== null) {\n\t\t\t\t// Update path handles\n\t\t\t\tupdatePathHandles(layer);\n\t\t\t}\n\t\t}\n\t},\n\t// Update handle positions when dragging parent layer\n\tdrag: function (layer) {\n\t\tif (isRectLayer(layer)) {\n\t\t\tupdateRectHandles(layer);\n\t\t} else if (isPathLayer(layer)) {\n\t\t\tupdatePathHandles(layer);\n\t\t}\n\t},\n} as typeof $.jCanvas.eventHooks);\n"],"names":["$","isRectLayer","layer","method","isPathLayer","addPathHandle","$canvas","parent","xProp","yProp","handle","updatePathGuides","addRectHandle","px","py","cursor","nonNullWidth","nonNullHeight","updateRectHandles","addRectHandles","handlePlacement","addRectGuides","updateRectGuides","guide","guideProps","addPathHandles","key","addPathGuides","handles","guides","h","g","nextHandle","prevHandle","otherHandle","updatePathHandles","addHandles","removeHandles","objectContainsPathCoords","obj","prop","props","fx"],"mappings":"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"}
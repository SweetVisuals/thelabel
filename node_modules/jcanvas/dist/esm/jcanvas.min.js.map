{"version":3,"file":"jcanvas.min.js","sources":["../../src/jcanvas.ts"],"sourcesContent":["/**\n * @license jCanvas\n * Copyright 2017-2024 Caleb Evans\n * Released under the MIT license\n */\nimport $ from \"jquery\";\nimport \"./jcanvas.d\";\n\n// Define local aliases t o frequently used properties\nconst extendObject = Object.assign,\n\tinArray = $.inArray,\n\ttypeOf = function (operand: any) {\n\t\treturn Object.prototype.toString.call(operand).slice(8, -1).toLowerCase();\n\t},\n\tisPlainObject = $.isPlainObject,\n\t// Math constants and functions\n\tPI = Math.PI,\n\tround = Math.round,\n\tabs = Math.abs,\n\tsin = Math.sin,\n\tcos = Math.cos,\n\tatan2 = Math.atan2,\n\t// jQuery's internal event normalization function\n\tjQueryEventFix = ($.event as JQueryEventWithFix).fix,\n\t// Object for storing a number of internal property maps\n\tmaps: JCanvasMaps = {\n\t\t// Map drawing names with their respective method names\n\t\tdrawings: {\n\t\t\tarc: \"drawArc\",\n\t\t\tbezier: \"drawBezier\",\n\t\t\tellipse: \"drawEllipse\",\n\t\t\tfunction: \"draw\",\n\t\t\timage: \"drawImage\",\n\t\t\tline: \"drawLine\",\n\t\t\tpath: \"drawPath\",\n\t\t\tpolygon: \"drawPolygon\",\n\t\t\tslice: \"drawSlice\",\n\t\t\tquadratic: \"drawQuadratic\",\n\t\t\trectangle: \"drawRect\",\n\t\t\ttext: \"drawText\",\n\t\t\tvector: \"drawVector\",\n\t\t\tsave: \"saveCanvas\",\n\t\t\trestore: \"restoreCanvas\",\n\t\t\trotate: \"rotateCanvas\",\n\t\t\tscale: \"scaleCanvas\",\n\t\t\ttranslate: \"translateCanvas\",\n\t\t},\n\t\ttouchEvents: {\n\t\t\tmousedown: \"touchstart\",\n\t\t\tmouseup: \"touchend\",\n\t\t\tmousemove: \"touchmove\",\n\t\t},\n\t\t// Map standard touch events to mouse events\n\t\tmouseEvents: {\n\t\t\ttouchstart: \"mousedown\",\n\t\t\ttouchend: \"mouseup\",\n\t\t\ttouchmove: \"mousemove\",\n\t\t},\n\t},\n\t// jQuery internal caches\n\tcaches: JCanvasCache = {\n\t\tdataCache: {},\n\t\tpropCache: {},\n\t\timageCache: {},\n\t\tpathCache: {},\n\t},\n\t// Base transformations\n\tbaseTransforms: JCanvasBaseTransforms = {\n\t\trotate: 0,\n\t\tscaleX: 1,\n\t\tscaleY: 1,\n\t\ttranslateX: 0,\n\t\ttranslateY: 0,\n\t\t// Store all previous masks\n\t\tmasks: [],\n\t},\n\tcss: JCanvasCss = {\n\t\t// Define properties used in both CSS and jCanvas\n\t\tprops: [\"width\", \"height\", \"opacity\", \"lineHeight\"],\n\t\tpropsObj: {},\n\t},\n\ttangibleEvents: (\n\t\t| JCanvasMouseEventName\n\t\t| JCanvasTouchEventName\n\t\t| JCanvasPointerEventName\n\t)[] = [\n\t\t\"mousedown\",\n\t\t\"mousemove\",\n\t\t\"mouseup\",\n\t\t\"mouseover\",\n\t\t\"mouseout\",\n\t\t\"touchstart\",\n\t\t\"touchmove\",\n\t\t\"touchend\",\n\t\t\"pointerdown\",\n\t\t\"pointermove\",\n\t\t\"pointerup\",\n\t];\n\n// jCanvas object in which global settings are other data are stored\nconst jCanvas = {\n\t// Events object for storing jCanvas event initiation functions\n\tevents: {},\n\t// Object containing all jCanvas event hooks\n\teventHooks: {},\n\t// Settings for enabling future jCanvas features\n\tfuture: {},\n\t// Need to type assert since some public API methods like transformShape are\n\t// lazily added to this object\n} as JCanvas;\n\n// jCanvas default property values\nclass jCanvasDefaults implements JCanvasDefaults {\n\talign: CanvasRenderingContext2D[\"textAlign\"] = \"center\";\n\tarrowAngle: number = 90;\n\tarrowRadius: number = 0;\n\tautosave: boolean = true;\n\tbaseline: CanvasRenderingContext2D[\"textBaseline\"] = \"middle\";\n\tbringToFront: boolean = false;\n\tcanvas: HTMLCanvasElement | null = null;\n\tccw: boolean = false;\n\tclosed: boolean = false;\n\tcompositing: CanvasRenderingContext2D[\"globalCompositeOperation\"] =\n\t\t\"source-over\";\n\tconcavity: number = 0;\n\tcornerRadius: number = 0;\n\tcount: number = 1;\n\tcropFromCenter: boolean = true;\n\tcrossOrigin: HTMLImageElement[\"crossOrigin\"] = null;\n\tcursors: Record<string, string> | null = null;\n\tdisableEvents: boolean = false;\n\tdraggable: boolean = false;\n\tdragging: boolean = false;\n\tdragGroups: string[] | null = null;\n\tgroups: string[] | null = null;\n\td: string | null = null;\n\tdata: object | null = null;\n\tdx: number = 0;\n\tdy: number = 0;\n\tend: number = 360;\n\tendArrow: boolean = false;\n\teventX: number | null = null;\n\teventY: number | null = null;\n\tfillRule: CanvasFillRule = \"nonzero\";\n\tfillStyle: string | CanvasGradient | CanvasPattern | JCanvasStyleFunction =\n\t\t\"transparent\";\n\tflipArcText: boolean = false;\n\tfontStyle: string = \"normal\";\n\tfontSize: string = \"12pt\";\n\tfontFamily: string = \"sans-serif\";\n\tfromCenter: boolean = true;\n\theight: number | null = null;\n\timageSmoothing: boolean = true;\n\tinDegrees: boolean = true;\n\tintangible: boolean = false;\n\tindex: number | null = null;\n\tintersects: boolean = false;\n\tletterSpacing: number | null = null;\n\tlineHeight: number = 1;\n\tlayer: boolean = false;\n\tmask: boolean = false;\n\tmaxWidth: number | null = null;\n\tmethod: keyof JQuery | null = null;\n\tmiterLimit: number = 10;\n\tname: string | null = null;\n\topacity: number = 1;\n\tr1: number | null = null;\n\tr2: number | null = null;\n\tradius: number = 0;\n\trepeat: Parameters<CanvasRenderingContext2D[\"createPattern\"]>[1] = \"repeat\";\n\trespectAlign: boolean = false;\n\trestrictDragToAxis: \"x\" | \"y\" | null = null;\n\trotate: number = 0;\n\trounded: boolean = false;\n\tscale: number = 1;\n\tscaleX: number = 1;\n\tscaleY: number = 1;\n\tshadowBlur: number = 0;\n\tshadowColor: string = \"transparent\";\n\tshadowStroke: boolean = false;\n\tshadowX: number = 0;\n\tshadowY: number = 0;\n\tsHeight: number | null = null;\n\tsides: number = 0;\n\tsource: string | HTMLImageElement | HTMLCanvasElement = \"\";\n\tspread: number = 0;\n\tstart: number = 0;\n\tstartArrow: boolean = false;\n\tstrokeCap: CanvasRenderingContext2D[\"lineCap\"] = \"butt\";\n\tstrokeDash: number[] | null = null;\n\tstrokeDashOffset: CanvasRenderingContext2D[\"lineDashOffset\"] = 0;\n\tstrokeJoin: CanvasRenderingContext2D[\"lineJoin\"] = \"miter\";\n\tstrokeStyle: string | CanvasGradient | CanvasPattern | JCanvasStyleFunction =\n\t\t\"transparent\";\n\tstrokeWidth: number = 1;\n\tstyle: Record<string, boolean> = {};\n\tsWidth: number | null = null;\n\tsx: number | null = null;\n\tsy: number | null = null;\n\ttext: string = \"\";\n\ttranslate: number = 0;\n\ttranslateX: number = 0;\n\ttranslateY: number = 0;\n\ttype: string | null = null;\n\tvisible: boolean = true;\n\twidth: number | null = null;\n\twillReadFrequently: boolean = false;\n\tx: number = 0;\n\ty: number = 0;\n\t[key: `x${number}`]: number;\n\t[key: `y${number}`]: number;\n\t[key: `cx${number}`]: number;\n\t[key: `cy${number}`]: number;\n\t[key: `a${number}`]: number;\n\t[key: `l${number}`]: number;\n\t[key: `p${number}`]: number;\n\t[key: `_${string}`]: any;\n}\nconst defaults = new jCanvasDefaults();\n\n// Constructor for creating objects that inherit from jCanvas preferences and defaults\nconst jCanvasObject: JCanvasObjectFunction = function jCanvasObject(args) {\n\treturn extendObject(this, args);\n} as JCanvasObjectFunction;\njCanvasObject.prototype = defaults;\n\n// Constructor for creating a fully-qualified jCanvas layer\nconst jCanvasLayer: JCanvasLayerFunction = function jCanvasLayer(\n\tcanvas,\n\tparams\n) {\n\tObject.assign(this, params, {\n\t\tcanvas,\n\t\t_layer: true,\n\t});\n} as JCanvasLayerFunction;\njCanvasLayer.prototype = jCanvasObject.prototype;\n\nfunction _getParamsObject(args?: Partial<JCanvasObject>) {\n\treturn args?._layer ? (args as JCanvasLayer) : new jCanvasObject(args);\n}\n\n/* Internal helper methods */\n\n// Determines if the given operand is a string\nfunction isString(operand: any): operand is string {\n\treturn typeOf(operand) === \"string\";\n}\n\n// Determines if the given operand is a function\nfunction isFunction(operand: any): operand is Function {\n\treturn typeOf(operand) === \"function\";\n}\n\n// Determines if the given operand is numeric\nfunction isNumeric(operand: any): operand is number | string {\n\treturn !isNaN(Number(operand)) && !isNaN(parseFloat(operand));\n}\n\n// Tells TypeScript that the given element is a canvas\nfunction _isCanvas(element: HTMLElement): element is HTMLCanvasElement {\n\treturn element instanceof HTMLCanvasElement;\n}\n\n// Get 2D context for the given canvas\nfunction _getContext(\n\tcanvas: HTMLCanvasElement\n): CanvasRenderingContext2D | null {\n\tif ($.jCanvas.defaults.willReadFrequently) {\n\t\treturn canvas.getContext(\"2d\", {\n\t\t\twillReadFrequently: $.jCanvas.defaults.willReadFrequently,\n\t\t});\n\t} else {\n\t\treturn canvas.getContext(\"2d\");\n\t}\n}\n\n// Coerce designated number properties from strings to numbers\nfunction _coerceNumericProps(props: Partial<JCanvasObject>) {\n\t// Loop through all properties in given property map\n\tfor (const propName in props) {\n\t\tif (Object.prototype.hasOwnProperty.call(props, propName)) {\n\t\t\tconst propValue = props[propName as keyof typeof props];\n\t\t\tconst propType = typeOf(propValue);\n\t\t\t// If property is non-empty string and value is numeric\n\t\t\tif (\n\t\t\t\tpropType === \"string\" &&\n\t\t\t\tisNumeric(propValue) &&\n\t\t\t\tpropName !== \"text\"\n\t\t\t) {\n\t\t\t\t// Convert value to number\n\t\t\t\tprops[propName as keyof typeof props] = parseFloat(String(propValue));\n\t\t\t}\n\t\t}\n\t}\n\t// Ensure value of text property is always a string\n\tif (props.text !== undefined) {\n\t\tprops.text = String(props.text);\n\t}\n}\n\n// Clone the given transformations object\nfunction _cloneTransforms(transforms: JCanvasBaseTransforms) {\n\t// Clone the object itself\n\ttransforms = extendObject({}, transforms);\n\t// Clone the object's masks array\n\ttransforms.masks = transforms.masks.slice(0);\n\treturn transforms;\n}\n\n// Save canvas context and update transformation stack\nfunction _saveCanvas(ctx: CanvasRenderingContext2D, data: JCanvasInternalData) {\n\tctx.save();\n\tconst transforms = _cloneTransforms(data.transforms);\n\tdata.savedTransforms.push(transforms);\n}\n\n// Restore canvas context update transformation stack\nfunction _restoreCanvas(\n\tctx: CanvasRenderingContext2D,\n\tdata: JCanvasInternalData\n) {\n\tif (data.savedTransforms.length === 0) {\n\t\t// Reset transformation state if it can't be restored any more\n\t\tdata.transforms = _cloneTransforms(baseTransforms);\n\t} else {\n\t\t// Restore canvas context\n\t\tctx.restore();\n\t\t// Restore current transform state to the last saved state\n\t\tconst lastTransform = data.savedTransforms.pop();\n\t\tif (lastTransform) {\n\t\t\tdata.transforms = lastTransform;\n\t\t}\n\t}\n}\n\n// Set the style with the given name\nfunction _setStyle(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tstyleName: \"fillStyle\" | \"strokeStyle\"\n) {\n\tconst styleValue = params[styleName];\n\tif (styleValue) {\n\t\tif (isFunction(styleValue)) {\n\t\t\t// Handle functions\n\t\t\tctx[styleName] = styleValue.call(canvas, params);\n\t\t} else {\n\t\t\t// Handle string, gradients, and patterns\n\t\t\tctx[styleName] = styleValue;\n\t\t}\n\t}\n}\n\n// Set canvas context properties\nfunction _setGlobalProps(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject\n) {\n\t_setStyle(canvas, ctx, params, \"fillStyle\");\n\t_setStyle(canvas, ctx, params, \"strokeStyle\");\n\tctx.lineWidth = params.strokeWidth;\n\t// Optionally round corners for paths\n\tif (params.rounded) {\n\t\tctx.lineCap = ctx.lineJoin = \"round\";\n\t} else {\n\t\tctx.lineCap = params.strokeCap;\n\t\tctx.lineJoin = params.strokeJoin;\n\t\tctx.miterLimit = params.miterLimit;\n\t}\n\t// Reset strokeDash if null\n\tif (!params.strokeDash) {\n\t\tparams.strokeDash = [];\n\t}\n\t// Dashed lines\n\tif (ctx.setLineDash) {\n\t\tctx.setLineDash(params.strokeDash);\n\t}\n\t// @ts-expect-error Permit vendor-prefixed property\n\tctx.webkitLineDash = params.strokeDash;\n\tctx.lineDashOffset =\n\t\t// @ts-expect-error Permit vendor-prefixed property\n\t\tctx.webkitLineDashOffset =\n\t\t// @ts-expect-error Permit vendor-prefixed property\n\t\tctx.mozDashOffset =\n\t\t\tparams.strokeDashOffset;\n\t// Drop shadow\n\tctx.shadowOffsetX = params.shadowX;\n\tctx.shadowOffsetY = params.shadowY;\n\tctx.shadowBlur = params.shadowBlur;\n\tctx.shadowColor = params.shadowColor;\n\t// Opacity and composite operation\n\tctx.globalAlpha = params.opacity;\n\tctx.globalCompositeOperation = params.compositing;\n\t// Support cross-browser toggling of image smoothing\n\tif (params.imageSmoothing) {\n\t\tctx.imageSmoothingEnabled = params.imageSmoothing;\n\t}\n}\n\n// Optionally enable masking support for this path\nfunction _enableMasking(\n\tctx: CanvasRenderingContext2D,\n\tdata: JCanvasInternalData,\n\tparams: JCanvasObject\n) {\n\tif (params.mask) {\n\t\t// If jCanvas autosave is enabled\n\t\tif (params.autosave) {\n\t\t\t// Automatically save transformation state by default\n\t\t\t_saveCanvas(ctx, data);\n\t\t}\n\t\t// Clip the current path\n\t\tif (params._path) {\n\t\t\tctx.clip(params._path, params.fillRule);\n\t\t} else {\n\t\t\tctx.clip(params.fillRule);\n\t\t}\n\t\t// Keep track of current masks\n\t\tdata.transforms.masks.push(params._args);\n\t}\n}\n\n// Restore individual shape transformation\nfunction _restoreTransform(\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject\n) {\n\t// If shape has been transformed by jCanvas\n\tif (params._transformed) {\n\t\t// Restore canvas context\n\t\tctx.restore();\n\t}\n}\n\n// Close current canvas path\nfunction _closePath(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject\n) {\n\t// Optionally close path\n\tif (params.closed) {\n\t\tctx.closePath();\n\t}\n\n\tif (params.shadowStroke && params.strokeWidth !== 0) {\n\t\t// Extend the shadow to include the stroke of a drawing\n\n\t\t// Add a stroke shadow by stroking before filling\n\t\tif (params._path) {\n\t\t\tctx.stroke(params._path);\n\t\t\tctx.fill(params._path, params.fillRule);\n\t\t} else {\n\t\t\tctx.stroke();\n\t\t\tctx.fill(params.fillRule);\n\t\t}\n\t\t// Ensure the below stroking does not inherit a shadow\n\t\tctx.shadowColor = \"transparent\";\n\t\tctx.shadowBlur = 0;\n\t\t// Stroke over fill as usual\n\t\tif (params._path) {\n\t\t\tctx.stroke(params._path);\n\t\t} else {\n\t\t\tctx.stroke();\n\t\t}\n\t} else {\n\t\t// If shadowStroke is not enabled, stroke & fill as usual\n\n\t\tif (params._path) {\n\t\t\tctx.fill(params._path, params.fillRule);\n\t\t} else {\n\t\t\tctx.fill(params.fillRule);\n\t\t}\n\t\t// Prevent extra shadow created by stroke (but only when fill is present)\n\t\tif (params.fillStyle !== \"transparent\") {\n\t\t\tctx.shadowColor = \"transparent\";\n\t\t}\n\t\tif (params.strokeWidth !== 0) {\n\t\t\t// Only stroke if the stroke is not 0\n\t\t\tif (params._path) {\n\t\t\t\tctx.stroke(params._path);\n\t\t\t} else {\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t}\n\t}\n\n\t// Optionally close path\n\tif (!params.closed) {\n\t\tctx.closePath();\n\t}\n\n\t// Restore individual shape transformation\n\t_restoreTransform(ctx, params);\n\n\t// Mask shape if chosen\n\tif (params.mask) {\n\t\t// Retrieve canvas data\n\t\tconst data = _getCanvasData(canvas);\n\t\t_enableMasking(ctx, data, params);\n\t}\n}\n\n// Transform (translate, scale, or rotate) shape\nfunction _transformShape(\n\t_canvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\twidth: number | null = null,\n\theight: number | null = null\n) {\n\t// Get conversion factor for radians\n\tparams._toRad = params.inDegrees ? PI / 180 : 1;\n\n\tparams._transformed = true;\n\tctx.save();\n\n\t// Optionally measure (x, y) position from top-left corner\n\tif (\n\t\t!params.fromCenter &&\n\t\t!params._centered &&\n\t\twidth !== null &&\n\t\theight !== null\n\t) {\n\t\t// Always draw from center unless otherwise specified\n\t\tif (height === undefined) {\n\t\t\theight = width;\n\t\t}\n\t\tparams.x += width / 2;\n\t\tparams.y += height / 2;\n\t\tparams._centered = true;\n\t}\n\t// Optionally rotate shape\n\tif (params.rotate) {\n\t\t_rotateCanvas(ctx, params, null);\n\t}\n\t// Optionally scale shape\n\tif (params.scale !== 1 || params.scaleX !== 1 || params.scaleY !== 1) {\n\t\t_scaleCanvas(ctx, params, null);\n\t}\n\t// Optionally translate shape\n\tif (params.translate || params.translateX || params.translateY) {\n\t\t_translateCanvas(ctx, params, null);\n\t}\n}\n\n/* Plugin API */\n\n// Extend jCanvas with a user-defined method\njCanvas.extend = function extend(plugin) {\n\t// Create plugin\n\tif (plugin.name) {\n\t\t// Merge properties with defaults\n\t\tif (plugin.props) {\n\t\t\textendObject(defaults, plugin.props);\n\t\t}\n\t\t// Define plugin method\n\t\t// @ts-expect-error TODO: fix this\n\t\t$.fn[plugin.name] = function self(args) {\n\t\t\tconst $canvases = this;\n\n\t\t\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\t\t\tconst canvas = $canvases[e];\n\t\t\t\tif (!_isCanvas(canvas)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst ctx = _getContext(canvas);\n\t\t\t\tif (!ctx) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst params = _getParamsObject(args);\n\t\t\t\t_addLayer(canvas, params, args, self);\n\n\t\t\t\t_setGlobalProps(canvas, ctx, params);\n\t\t\t\tplugin.fn.call(canvas, ctx, params);\n\t\t\t}\n\t\t\treturn $canvases;\n\t\t};\n\t\t// Add drawing type to drawing map\n\t\tif (plugin.type) {\n\t\t\tmaps.drawings[plugin.type] = plugin.name as string;\n\t\t}\n\t}\n\t// @ts-expect-error TODO: fix this\n\treturn $.fn[plugin.name];\n};\n\n/* Layer API */\n\nclass JCanvasInternalData {\n\t// The associated canvas element\n\tcanvas: HTMLCanvasElement;\n\t// Layers array\n\tlayers: JCanvasLayer[] = [];\n\t// Layer maps\n\tlayer: {\n\t\tnames: Record<string, JCanvasLayer>;\n\t\tgroups: Record<string, JCanvasLayer[]>;\n\t} = {\n\t\tnames: {},\n\t\tgroups: {},\n\t};\n\teventHooks = {};\n\t// All layers that intersect with the event coordinates (regardless of visibility)\n\tintersecting: JCanvasLayer[] = [];\n\t// The topmost layer whose area contains the event coordinates\n\tlastIntersected: JCanvasLayer | null = null;\n\tcursor: string;\n\t// Properties for the current drag event\n\tdrag = {\n\t\tlayer: null as JCanvasLayer | null,\n\t\tdragging: false,\n\t};\n\t// Data for the current event\n\tevent: {\n\t\ttype: JCanvasInteractionEventName | null;\n\t\tx: number | null;\n\t\ty: number | null;\n\t\tevent?: Event | null;\n\t} = {\n\t\ttype: null,\n\t\tx: null,\n\t\ty: null,\n\t};\n\t// Events which already have been bound to the canvas\n\tevents: Record<string, boolean> = {};\n\t// The canvas's current transformation state\n\ttransforms: JCanvasBaseTransforms;\n\tsavedTransforms: JCanvasBaseTransforms[] = [];\n\t// Whether a layer is being animated or not\n\tanimating = false;\n\t// The layer currently being animated\n\tanimated: JCanvasLayer | null = null;\n\t// The device pixel ratio\n\tpixelRatio = 1;\n\t// Whether pixel ratio transformations have been applied\n\tscaled = false;\n\t// Whether the canvas should be redrawn when a layer mousemove\n\t// event triggers (either directly, or indirectly via dragging)\n\tredrawOnMousemove = false;\n\toriginalRedrawOnMousemove = false;\n\tdrawLayersComplete?: () => void;\n\tconstructor(canvas: HTMLCanvasElement) {\n\t\tthis.canvas = canvas;\n\t\tthis.cursor = $(canvas).css(\"cursor\");\n\t\tthis.transforms = _cloneTransforms(baseTransforms);\n\t}\n}\n\n// Retrieved the stored jCanvas data for a canvas element\nfunction _getCanvasData(canvas: HTMLCanvasElement) {\n\tconst dataCache = caches.dataCache;\n\tlet data: JCanvasInternalData;\n\tif (dataCache._canvas === canvas && dataCache._data) {\n\t\t// Retrieve canvas data from cache if possible\n\t\tdata = dataCache._data;\n\t} else {\n\t\t// Retrieve canvas data from jQuery's internal data storage\n\t\tdata = $.data(canvas, \"jCanvas\");\n\t\tif (!data) {\n\t\t\t// Create canvas data object if it does not already exist\n\t\t\tdata = new JCanvasInternalData(canvas);\n\t\t\t// Use jQuery to store canvas data\n\t\t\t$.data(canvas, \"jCanvas\", data);\n\t\t}\n\t\t// Cache canvas data for faster retrieval\n\t\tdataCache._canvas = canvas;\n\t\tdataCache._data = data;\n\t}\n\treturn data;\n}\n\n// Initialize all of a layer's associated jCanvas events\nfunction _addLayerEvents(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tdata: JCanvasInternalData,\n\tlayer: JCanvasLayer\n) {\n\t// Determine which jCanvas events need to be bound to this layer\n\tfor (const eventName in jCanvas.events) {\n\t\tif (Object.prototype.hasOwnProperty.call(jCanvas.events, eventName)) {\n\t\t\t// If layer has callback function to complement it\n\t\t\tif (\n\t\t\t\tlayer[eventName as keyof JCanvasLayer] ||\n\t\t\t\tlayer.cursors?.[eventName]\n\t\t\t) {\n\t\t\t\t// Bind event to layer\n\t\t\t\t_addExplicitLayerEvent($canvas, data, layer, eventName);\n\t\t\t}\n\t\t}\n\t}\n\tif (!data.events.mouseout) {\n\t\t$canvas.on(\"mouseout.jCanvas\", function () {\n\t\t\tlet shouldRedraw = false;\n\t\t\t// Retrieve the layer whose drag event was canceled\n\t\t\tconst dragLayer = data.drag.layer;\n\t\t\t// If cursor mouses out of canvas while dragging\n\t\t\tif (dragLayer) {\n\t\t\t\t// Cancel drag\n\t\t\t\tdata.drag = { layer: null, dragging: false };\n\t\t\t\t_triggerLayerEvent($canvas, data, dragLayer, \"dragcancel\");\n\t\t\t\tshouldRedraw = true;\n\t\t\t}\n\t\t\t// Loop through all layers\n\t\t\tfor (let l = 0; l < data.layers.length; l += 1) {\n\t\t\t\tlayer = data.layers[l];\n\t\t\t\t// If layer thinks it's still being moused over\n\t\t\t\tif (layer?._hovered) {\n\t\t\t\t\t// Trigger mouseout on layer\n\t\t\t\t\t$canvas.triggerLayerEvent(data.layers[l], \"mouseout\");\n\t\t\t\t\tshouldRedraw = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Redraw layers only if an event has been triggered\n\t\t\tif (shouldRedraw) {\n\t\t\t\t$canvas.drawLayers();\n\t\t\t}\n\t\t});\n\t\t// Indicate that an event handler has been bound\n\t\tdata.events.mouseout = true;\n\t}\n}\n\n// Initialize the given event on the given layer\nfunction _addLayerEvent(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tdata: JCanvasInternalData,\n\tlayer: JCanvasLayer,\n\teventName: string\n) {\n\t// Use touch events if appropriate\n\t// eventName = _getMouseEventName(eventName);\n\t// Bind event to layer\n\tjCanvas.events[eventName]($canvas, data);\n\tlayer._event = true;\n}\n\n// Add a layer event that was explicitly declared in the layer's parameter map,\n// excluding events added implicitly (e.g. mousemove event required by draggable\n// layers)\nfunction _addExplicitLayerEvent(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tdata: JCanvasInternalData,\n\tlayer: JCanvasLayer,\n\teventName: string\n) {\n\t_addLayerEvent($canvas, data, layer, eventName);\n\tif (\n\t\teventName === \"mouseover\" ||\n\t\teventName === \"mouseout\" ||\n\t\teventName === \"mousemove\"\n\t) {\n\t\tdata.redrawOnMousemove = true;\n\t}\n}\n\n// Enable drag support for this layer\nfunction _enableDrag(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tdata: JCanvasInternalData,\n\tlayer: JCanvasLayer\n) {\n\t// Only make layer draggable if necessary\n\tif (layer.draggable || layer.cursors) {\n\t\t// Organize helper events which enable drag support\n\t\tconst dragHelperEvents = [\"mousedown\", \"mousemove\", \"mouseup\"];\n\n\t\t// Bind each helper event to the canvas\n\t\tfor (let i = 0; i < dragHelperEvents.length; i += 1) {\n\t\t\t// Use touch events if appropriate\n\t\t\tconst eventName = dragHelperEvents[i];\n\t\t\t// Bind event\n\t\t\t_addLayerEvent($canvas, data, layer, eventName);\n\t\t}\n\t\t// Indicate that this layer has events bound to it\n\t\tlayer._event = true;\n\t}\n}\n\n// Update a layer property map if property is changed\nfunction _updateLayerName(\n\tdata: JCanvasInternalData,\n\tlayer: JCanvasLayer,\n\tprops?: Partial<JCanvasObject>\n) {\n\tconst nameMap = data.layer.names;\n\n\t// If layer name is being added, not changed\n\tif (!props) {\n\t\tprops = layer;\n\t} else {\n\t\t// Remove old layer name entry because layer name has changed\n\t\tif (\n\t\t\tprops.name !== undefined &&\n\t\t\tisString(layer.name) &&\n\t\t\tlayer.name !== props.name\n\t\t) {\n\t\t\tdelete nameMap[layer.name];\n\t\t}\n\t}\n\n\t// Add new entry to layer name map with new name\n\tif (isString(props.name)) {\n\t\tnameMap[props.name] = layer;\n\t}\n}\n\n// Create or update the data map for the given layer and group type\nfunction _updateLayerGroups(\n\tdata: JCanvasInternalData,\n\tlayer: JCanvasLayer,\n\tprops?: Partial<JCanvasObject>\n) {\n\tconst groupMap = data.layer.groups;\n\tlet index: number | undefined = undefined;\n\n\t// If group name is not changing\n\tif (!props) {\n\t\tprops = layer;\n\t} else {\n\t\t// Remove layer from all of its associated groups\n\t\tif (props.groups !== undefined && layer.groups !== null) {\n\t\t\tfor (let g = 0; g < layer.groups.length; g += 1) {\n\t\t\t\tconst groupName = layer.groups[g];\n\t\t\t\tconst group = groupMap[groupName];\n\t\t\t\tif (group) {\n\t\t\t\t\t// Remove layer from its old layer group entry\n\t\t\t\t\tfor (let l = 0; l < group.length; l += 1) {\n\t\t\t\t\t\tif (group[l] === layer) {\n\t\t\t\t\t\t\t// Keep track of the layer's initial index\n\t\t\t\t\t\t\tindex = l;\n\t\t\t\t\t\t\t// Remove layer once found\n\t\t\t\t\t\t\tgroup.splice(l, 1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Remove layer group entry if group is empty\n\t\t\t\t\tif (group.length === 0) {\n\t\t\t\t\t\tdelete groupMap[groupName];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Add layer to new group if a new group name is given\n\tif (props.groups !== undefined && props.groups !== null) {\n\t\tfor (let g = 0; g < props.groups.length; g += 1) {\n\t\t\tconst groupName = props.groups[g];\n\n\t\t\tlet group = groupMap[groupName];\n\t\t\tif (!group) {\n\t\t\t\t// Create new group entry if it doesn't exist\n\t\t\t\tgroup = groupMap[groupName] = [];\n\t\t\t}\n\t\t\tif (index === undefined) {\n\t\t\t\t// Add layer to end of group unless otherwise stated\n\t\t\t\tindex = group.length;\n\t\t\t}\n\t\t\t// Add layer to its new layer group\n\t\t\tgroup.splice(index, 0, layer);\n\t\t}\n\t}\n}\n\n// Get event hooks object for the first selected canvas\n$.fn.getEventHooks = function getEventHooks() {\n\tconst $canvases = this;\n\n\tif ($canvases.length !== 0) {\n\t\tconst canvas = $canvases[0];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\treturn {};\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\t\treturn data.eventHooks;\n\t}\n\treturn {};\n};\n\n// Set event hooks for the selected canvases\n$.fn.setEventHooks = function setEventHooks(eventHooks) {\n\tconst $canvases = this;\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\t\textendObject(data.eventHooks, eventHooks);\n\t}\n\treturn $canvases;\n};\n\n// Get jCanvas layers array\n$.fn.getLayers = function getLayers(callback) {\n\tconst $canvases = this;\n\tlet matching: JCanvasLayer[] = [];\n\n\tif ($canvases.length !== 0) {\n\t\tconst canvas = $canvases[0];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\treturn matching;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\t\t// Retrieve layers array for this canvas\n\t\tconst layers = data.layers;\n\n\t\t// If a callback function is given\n\t\tif (isFunction(callback)) {\n\t\t\t// Filter the layers array using the callback\n\t\t\tfor (let l = 0; l < layers.length; l += 1) {\n\t\t\t\tconst layer = layers[l];\n\t\t\t\tif (callback.call(canvas, layer)) {\n\t\t\t\t\t// Add layer to array of matching layers if test passes\n\t\t\t\t\tmatching.push(layer);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Otherwise, get all layers\n\n\t\t\tmatching = layers;\n\t\t}\n\t}\n\treturn matching;\n};\n\n// Get a single jCanvas layer object\n$.fn.getLayer = function getLayer(layerId) {\n\tconst $canvases = this;\n\n\tif ($canvases.length !== 0) {\n\t\tconst canvas = $canvases[0];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst layers = data.layers;\n\t\tconst idType = typeOf(layerId);\n\n\t\tif (\n\t\t\tlayerId &&\n\t\t\ttypeof layerId === \"object\" &&\n\t\t\t\"layer\" in layerId &&\n\t\t\tlayerId.layer\n\t\t) {\n\t\t\t// Return the actual layer object if given\n\t\t\treturn layerId;\n\t\t} else if (idType === \"number\") {\n\t\t\t// Retrieve the layer using the given index\n\n\t\t\tlet layerIndex = layerId as number;\n\n\t\t\t// Allow for negative indices\n\t\t\tif (layerIndex < 0) {\n\t\t\t\tlayerIndex = layers.length + layerIndex;\n\t\t\t}\n\t\t\t// Get layer with the given index\n\t\t\treturn layers[layerIndex];\n\t\t} else if (idType === \"regexp\") {\n\t\t\tconst layerPattern = layerId as RegExp;\n\t\t\t// Get layer with the name that matches the given regex\n\t\t\tfor (let l = 0; l < layers.length; l += 1) {\n\t\t\t\tconst layer = layers[l];\n\t\t\t\t// Check if layer matches name\n\t\t\t\tif (isString(layer.name) && layer.name.match(layerPattern)) {\n\t\t\t\t\treturn layer;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst layerName = layerId as string;\n\t\t\t// Get layer with the given name\n\t\t\treturn data.layer.names[layerName];\n\t\t}\n\t}\n};\n\n// Get all layers in the given group\n$.fn.getLayerGroup = function getLayerGroup(groupId) {\n\tconst $canvases = this;\n\tconst idType = typeOf(groupId);\n\n\tif ($canvases.length !== 0) {\n\t\tconst canvas = $canvases[0];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (idType === \"array\") {\n\t\t\t// Return layer group if given\n\t\t\treturn groupId as Exclude<typeof groupId, string | RegExp>;\n\t\t} else if (idType === \"regexp\") {\n\t\t\tconst groupPattern = groupId as RegExp;\n\t\t\t// Get canvas data\n\t\t\tconst data = _getCanvasData(canvas);\n\t\t\tconst groups = data.layer.groups;\n\t\t\t// Loop through all layers groups for this canvas\n\t\t\tfor (const groupName in groups) {\n\t\t\t\t// Find a group whose name matches the given regex\n\t\t\t\tif (groupName.match(groupPattern)) {\n\t\t\t\t\t// Stop after finding the first matching group\n\t\t\t\t\treturn groups[groupName];\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (typeof groupId === \"string\") {\n\t\t\t// Find layer group with the given group name\n\t\t\tconst groupName = groupId as string;\n\t\t\tconst data = _getCanvasData(canvas);\n\t\t\treturn data.layer.groups[groupName];\n\t\t}\n\t}\n};\n\n// Get index of layer in layers array\n$.fn.getLayerIndex = function getLayerIndex(layerId) {\n\tconst $canvases = this;\n\tconst layers = $canvases.getLayers();\n\tconst layer = $canvases.getLayer(layerId);\n\n\treturn inArray(layer, layers);\n};\n\n// Set properties of a layer\n$.fn.setLayer = function setLayer(layerId, props) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst data = _getCanvasData(canvas);\n\n\t\tconst layer = $($canvases[e]).getLayer(layerId);\n\t\tif (layer) {\n\t\t\t// Update layer property maps\n\t\t\t_updateLayerName(data, layer, props);\n\t\t\t_updateLayerGroups(data, layer, props);\n\n\t\t\t_coerceNumericProps(props);\n\n\t\t\t// Merge properties with layer\n\t\t\tfor (const propName in props) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(props, propName)) {\n\t\t\t\t\tconst propValue = props[propName as keyof typeof props];\n\t\t\t\t\tconst propType = typeOf(propValue);\n\t\t\t\t\tif (propType === \"object\" && isPlainObject(propValue)) {\n\t\t\t\t\t\t// Clone objects\n\t\t\t\t\t\tlayer[propName as any] = extendObject({}, propValue);\n\t\t\t\t\t\t_coerceNumericProps(layer[propName as keyof JCanvasLayer]);\n\t\t\t\t\t} else if (propType === \"array\") {\n\t\t\t\t\t\t// Clone arrays\n\t\t\t\t\t\tlayer[propName as any] = propValue.slice(0);\n\t\t\t\t\t} else if (propType === \"string\") {\n\t\t\t\t\t\tif (propValue.indexOf(\"+=\") === 0) {\n\t\t\t\t\t\t\t// Increment numbers prefixed with +=\n\t\t\t\t\t\t\tlayer[propName as any] += parseFloat(propValue.substr(2));\n\t\t\t\t\t\t} else if (propValue.indexOf(\"-=\") === 0) {\n\t\t\t\t\t\t\t// Decrement numbers prefixed with -=\n\t\t\t\t\t\t\tlayer[propName as any] -= parseFloat(propValue.substr(2));\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t!isNaN(propValue) &&\n\t\t\t\t\t\t\tisNumeric(propValue) &&\n\t\t\t\t\t\t\tpropName !== \"text\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// Convert numeric values as strings to numbers\n\t\t\t\t\t\t\tlayer[propName as any] = parseFloat(String(propValue));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Otherwise, set given string value\n\t\t\t\t\t\t\tlayer[propName as any] = propValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Otherwise, set given value\n\t\t\t\t\t\tlayer[propName as any] = propValue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update layer events\n\t\t\t_addLayerEvents($canvas, data, layer);\n\t\t\t_enableDrag($canvas, data, layer);\n\n\t\t\t// If layer's properties were changed\n\t\t\tif ($.isEmptyObject(props) === false) {\n\t\t\t\t_triggerLayerEvent($canvas, data, layer, \"change\", props);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Set properties of all layers (optionally filtered by a callback)\n$.fn.setLayers = function setLayers(props, callback) {\n\tconst $canvases = this;\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst $canvas = $($canvases[e]);\n\n\t\tconst layers = $canvas.getLayers(callback);\n\t\t// Loop through all layers\n\t\tfor (let l = 0; l < layers.length; l += 1) {\n\t\t\t// Set properties of each layer\n\t\t\t$canvas.setLayer(layers[l], props);\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Set properties of all layers in the given group\n$.fn.setLayerGroup = function setLayerGroup(groupId, props) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\t// Get layer group\n\t\tconst $canvas = $($canvases[e]);\n\n\t\tconst group = $canvas.getLayerGroup(groupId);\n\t\t// If group exists\n\t\tif (group) {\n\t\t\t// Loop through layers in group\n\t\t\tfor (let l = 0; l < group.length; l += 1) {\n\t\t\t\t// Merge given properties with layer\n\t\t\t\t$canvas.setLayer(group[l], props);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Move a layer to the given index in the layers array\n$.fn.moveLayer = function moveLayer(layerId, index) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst data = _getCanvasData(canvas);\n\n\t\t// Retrieve layers array and desired layer\n\t\tconst layers = data.layers;\n\t\tconst layer = $canvas.getLayer(layerId);\n\t\tif (layer) {\n\t\t\t// Ensure layer index is accurate\n\t\t\tlayer.index = inArray(layer, layers);\n\n\t\t\t// Remove layer from its current placement\n\t\t\tlayers.splice(layer.index, 1);\n\t\t\t// Add layer in its new placement\n\t\t\tlayers.splice(index, 0, layer);\n\n\t\t\t// Handle negative indices\n\t\t\tif (index < 0) {\n\t\t\t\tindex = layers.length + index;\n\t\t\t}\n\t\t\t// Update layer's stored index\n\t\t\tlayer.index = index;\n\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"move\");\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Remove a jCanvas layer\n$.fn.removeLayer = function removeLayer(layerId) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst data = _getCanvasData(canvas);\n\n\t\t// Retrieve layers array and desired layer\n\t\tconst layers = $canvas.getLayers();\n\t\tconst layer = $canvas.getLayer(layerId);\n\t\t// Remove layer if found\n\t\tif (layer) {\n\t\t\t// Ensure layer index is accurate\n\t\t\tlayer.index = inArray(layer, layers);\n\t\t\t// Remove layer and allow it to be re-added later\n\t\t\tlayers.splice(layer.index, 1);\n\t\t\tdelete layer._layer;\n\n\t\t\t// Update layer name map\n\t\t\t_updateLayerName(data, layer, {\n\t\t\t\tname: null,\n\t\t\t});\n\t\t\t// Update layer group map\n\t\t\t_updateLayerGroups(data, layer, {\n\t\t\t\tgroups: null,\n\t\t\t});\n\n\t\t\t// Trigger 'remove' event\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"remove\");\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Remove all layers\n$.fn.removeLayers = function removeLayers(callback) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst layers = $canvas.getLayers(callback).slice(0);\n\t\t// Remove all layers individually\n\t\tfor (let l = 0; l < layers.length; l += 1) {\n\t\t\t$canvas.removeLayer(layers[l]);\n\t\t}\n\t\t// Update layer maps\n\t\tdata.layer.names = {};\n\t\tdata.layer.groups = {};\n\t}\n\treturn $canvases;\n};\n\n// Remove all layers in the group with the given ID\n$.fn.removeLayerGroup = function removeLayerGroup(groupId) {\n\tconst $canvases = this;\n\n\tif (groupId !== undefined) {\n\t\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\t\tconst $canvas = $($canvases[e]);\n\n\t\t\tlet group = $canvas.getLayerGroup(groupId);\n\t\t\t// Remove layer group using given group name\n\t\t\tif (group) {\n\t\t\t\t// Clone groups array\n\t\t\t\tgroup = group.slice(0);\n\n\t\t\t\t// Loop through layers in group\n\t\t\t\tfor (let l = 0; l < group.length; l += 1) {\n\t\t\t\t\t$canvas.removeLayer(group[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Add an existing layer to a layer group\n$.fn.addLayerToGroup = function addLayerToGroup(layerId, groupName) {\n\tconst $canvases = this;\n\tlet groups = [groupName];\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst $canvas = $($canvases[e]);\n\t\tconst layer = $canvas.getLayer(layerId);\n\n\t\t// If layer is not already in group\n\t\tif (layer?.groups) {\n\t\t\t// Clone groups list\n\t\t\tgroups = layer.groups.slice(0);\n\t\t\t// If layer is not already in group\n\t\t\tif (inArray(groupName, layer.groups) === -1) {\n\t\t\t\t// Add layer to group\n\t\t\t\tgroups.push(groupName);\n\t\t\t}\n\t\t}\n\t\t// Update layer group maps\n\t\t$canvas.setLayer(layer, {\n\t\t\tgroups: groups,\n\t\t});\n\t}\n\treturn $canvases;\n};\n\n// Remove an existing layer from a layer group\n$.fn.removeLayerFromGroup = function removeLayerFromGroup(layerId, groupName) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst $canvas = $($canvases[e]);\n\t\tconst layer = $canvas.getLayer(layerId);\n\n\t\tif (layer?.groups) {\n\t\t\t// Find index of layer in group\n\t\t\tconst index = inArray(groupName, layer.groups);\n\n\t\t\t// If layer is in group\n\t\t\tif (index !== -1) {\n\t\t\t\t// Clone groups list\n\t\t\t\tconst groups = layer.groups.slice(0);\n\n\t\t\t\t// Remove layer from group\n\t\t\t\tgroups.splice(index, 1);\n\n\t\t\t\t// Update layer group maps\n\t\t\t\t$canvas.setLayer(layer, {\n\t\t\t\t\tgroups: groups,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Get topmost layer that intersects with event coordinates\nfunction _getIntersectingLayer(data: JCanvasInternalData) {\n\t// Store the topmost layer\n\tlet layer: JCanvasLayer | null = null;\n\tlet mask: JCanvasObject;\n\n\t// Get the topmost layer whose visible area intersects event coordinates\n\tfor (let i = data.intersecting.length - 1; i >= 0; i -= 1) {\n\t\t// Get current layer\n\t\tlayer = data.intersecting[i];\n\n\t\t// If layer has previous masks\n\t\tif (layer._masks) {\n\t\t\t// Search previous masks to ensure\n\t\t\t// layer is visible at event coordinates\n\t\t\tfor (let m = layer._masks.length - 1; m >= 0; m -= 1) {\n\t\t\t\tmask = layer._masks[m];\n\t\t\t\t// If mask does not intersect event coordinates\n\t\t\t\tif (!mask.intersects) {\n\t\t\t\t\t// Indicate that the mask does not\n\t\t\t\t\t// intersect event coordinates\n\t\t\t\t\tlayer.intersects = false;\n\t\t\t\t\t// Stop searching previous masks\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If event coordinates intersect all previous masks\n\t\t\t// and layer is not intangible\n\t\t\tif (layer.intersects && !layer.intangible) {\n\t\t\t\t// Stop searching for topmost layer\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t// If resulting layer is intangible\n\tif (layer?.intangible) {\n\t\t// Cursor does not intersect this layer\n\t\tlayer = null;\n\t}\n\treturn layer;\n}\n\n// Draw individual layer (internal)\nfunction _drawLayer(\n\t$canvas: JQuery,\n\tlayer: JCanvasLayer,\n\tnextLayerIndex?: number\n) {\n\tif (layer.visible && layer._method) {\n\t\tlayer._next = nextLayerIndex || null;\n\t\t// If layer is an object, call its respective method\n\t\tlayer._method?.call($canvas, layer);\n\t}\n}\n\n// Handle dragging of the currently-dragged layer\nfunction _handleLayerDrag(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tdata: JCanvasInternalData,\n\teventType: JCanvasInteractionEventName\n) {\n\tconst drag = data.drag;\n\tconst layer = drag.layer as JCanvasLayer;\n\tconst dragGroups = layer?.dragGroups || [];\n\tconst layers = data.layers;\n\n\tif (eventType === \"mousemove\" || eventType === \"touchmove\") {\n\t\t// Detect when user is currently dragging layer\n\n\t\tif (!drag.dragging) {\n\t\t\t// Detect when user starts dragging layer\n\n\t\t\t// Signify that a layer on the canvas is being dragged\n\t\t\tdrag.dragging = true;\n\t\t\tlayer.dragging = true;\n\n\t\t\t// Optionally bring layer to front when drag starts\n\t\t\tif (layer.bringToFront && layer.index !== null) {\n\t\t\t\t// Remove layer from its original position\n\t\t\t\tlayers.splice(layer.index, 1);\n\t\t\t\t// Bring layer to front\n\t\t\t\t// push() returns the new array length\n\t\t\t\tlayer.index = layers.push(layer);\n\t\t\t}\n\n\t\t\t// Set drag properties for this layer\n\t\t\tlayer._startX = layer.x;\n\t\t\tlayer._startY = layer.y;\n\t\t\tlayer._endX = layer._eventX;\n\t\t\tlayer._endY = layer._eventY;\n\n\t\t\t// Trigger dragstart event\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"dragstart\");\n\t\t}\n\n\t\tif (drag.dragging) {\n\t\t\t// Calculate position after drag\n\t\t\tlet newX = layer._eventX - (layer._endX - layer._startX);\n\t\t\tlet newY = layer._eventY - (layer._endY - layer._startY);\n\t\t\tif (layer.updateDragX) {\n\t\t\t\tnewX = layer.updateDragX.call($canvas[0], layer, newX);\n\t\t\t}\n\t\t\tif (layer.updateDragY) {\n\t\t\t\tnewY = layer.updateDragY.call($canvas[0], layer, newY);\n\t\t\t}\n\t\t\tlayer.dx = newX - layer.x;\n\t\t\tlayer.dy = newY - layer.y;\n\t\t\tif (layer.restrictDragToAxis !== \"y\") {\n\t\t\t\tlayer.x = newX;\n\t\t\t}\n\t\t\tif (layer.restrictDragToAxis !== \"x\") {\n\t\t\t\tlayer.y = newY;\n\t\t\t}\n\n\t\t\t// Trigger drag event\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"drag\");\n\n\t\t\t// Move groups with layer on drag\n\t\t\tfor (let g = 0; g < dragGroups.length; g += 1) {\n\t\t\t\tconst groupName = dragGroups[g];\n\t\t\t\tconst group = data.layer.groups[groupName];\n\t\t\t\tif (layer.groups && group) {\n\t\t\t\t\tfor (let l = 0; l < group.length; l += 1) {\n\t\t\t\t\t\tif (group[l] !== layer) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tlayer.restrictDragToAxis !== \"y\" &&\n\t\t\t\t\t\t\t\tgroup[l].restrictDragToAxis !== \"y\"\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tgroup[l].x += layer.dx;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tlayer.restrictDragToAxis !== \"x\" &&\n\t\t\t\t\t\t\t\tgroup[l].restrictDragToAxis !== \"x\"\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tgroup[l].y += layer.dy;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (eventType === \"mouseup\" || eventType === \"touchend\") {\n\t\t// Detect when user stops dragging layer\n\n\t\tif (drag.dragging) {\n\t\t\tlayer.dragging = false;\n\t\t\tdrag.dragging = false;\n\t\t\tdata.redrawOnMousemove = data.originalRedrawOnMousemove;\n\t\t\t// Trigger dragstop event\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"dragstop\");\n\t\t}\n\n\t\t// Cancel dragging\n\t\tdata.drag = {\n\t\t\tlayer: null,\n\t\t\tdragging: false,\n\t\t};\n\t}\n}\n\n// Set cursor on canvas\nfunction _setCursor(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tlayer: JCanvasLayer,\n\teventType: JCanvasInteractionEventName\n) {\n\tlet cursor;\n\tif (layer.cursors) {\n\t\t// Retrieve cursor from cursors object if it exists\n\t\tcursor = layer.cursors[eventType];\n\t}\n\t// If cursor is defined\n\tif (cursor) {\n\t\t// Set canvas cursor\n\t\t$canvas.css({\n\t\t\tcursor: cursor,\n\t\t});\n\t}\n}\n\n// Reset cursor on canvas\nfunction _resetCursor(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tdata: JCanvasInternalData\n) {\n\t$canvas.css({\n\t\tcursor: data.cursor,\n\t});\n}\n\n// Run the given event callback with the given arguments\nfunction _runEventCallback(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tlayer: JCanvasLayer,\n\teventType: string,\n\tcallbacks: any,\n\targ: any\n) {\n\t// Prevent callback from firing recursively\n\tif (callbacks[eventType] && layer._running && !layer._running[eventType]) {\n\t\t// Signify the start of callback execution for this event\n\t\tlayer._running[eventType] = true;\n\t\t// Run event callback with the given arguments\n\t\tcallbacks[eventType].call($canvas[0], layer, arg);\n\t\t// Signify the end of callback execution for this event\n\t\tlayer._running[eventType] = false;\n\t}\n}\n\n// Determine if the given layer can \"legally\" fire the given event\nfunction _layerCanFireEvent(\n\tlayer: JCanvasLayer,\n\teventType: string\n): eventType is JCanvasMouseEventName | JCanvasTouchEventName {\n\t// If events are disable and if\n\t// layer is tangible or event is not tangible\n\treturn (\n\t\t!layer.disableEvents &&\n\t\t(!layer.intangible || inArray(eventType, tangibleEvents) === -1)\n\t);\n}\n\n// Trigger the given event on the given layer\nfunction _triggerLayerEvent(\n\t$canvas: JQuery<HTMLCanvasElement>,\n\tdata: JCanvasInternalData,\n\tlayer: JCanvasLayer,\n\teventType: JCanvasEventName,\n\targ?: any\n) {\n\t// If layer can legally fire this event type\n\tif (_layerCanFireEvent(layer, eventType)) {\n\t\t// Do not set a custom cursor on layer mouseout\n\t\tif (eventType !== \"mouseout\") {\n\t\t\t// Update cursor if one is defined for this event\n\t\t\t_setCursor($canvas, layer, eventType);\n\t\t}\n\n\t\t// Trigger the user-defined event callback\n\t\t_runEventCallback($canvas, layer, eventType, layer, arg);\n\t\t// Trigger the canvas-bound event hook\n\t\t_runEventCallback($canvas, layer, eventType, data.eventHooks, arg);\n\t\t// Trigger the global event hook\n\t\t_runEventCallback($canvas, layer, eventType, jCanvas.eventHooks, arg);\n\t}\n}\n\n// Manually trigger a layer event\n$.fn.triggerLayerEvent = function (layerId, eventType) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst layer = $canvas.getLayer(layerId);\n\t\tif (layer) {\n\t\t\t// We need to type assert here because the developer may trigger a\n\t\t\t// custom event that is not inherently part of JCanvasEventName;\n\t\t\t// this is a use case we want to allow\n\t\t\t_triggerLayerEvent($canvas, data, layer, eventType as JCanvasEventName);\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Draw layer with the given ID\n$.fn.drawLayer = function drawLayer(layerId) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst $canvas = $($canvases[e]);\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst layer = $canvas.getLayer(layerId);\n\t\tif (layer) {\n\t\t\t_drawLayer($canvas, layer);\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Draw all layers (or, if given, only layers starting at an index)\n$.fn.drawLayers = function drawLayers(args) {\n\tconst $canvases = this;\n\t// Internal parameters for redrawing the canvas\n\tconst params = args || {};\n\t// Other variables\n\tlet isImageLayer: boolean = false;\n\n\t// The layer index from which to start redrawing the canvas\n\tconst index = params.index || 0;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\t// Clear canvas first unless otherwise directed\n\t\tif (params.clear !== false) {\n\t\t\t$canvas.clearCanvas();\n\t\t}\n\n\t\t// If a completion callback was provided, save it to the canvas data\n\t\t// store so that the function can be passed to drawLayers() again\n\t\t// after any image layers have loaded\n\t\tif (params.complete) {\n\t\t\tdata.drawLayersComplete = params.complete;\n\t\t}\n\n\t\t// Cache the layers array\n\t\tconst layers = data.layers;\n\n\t\t// Draw layers from first to last (bottom to top)\n\t\tlet l;\n\t\tfor (l = index; l < layers.length; l += 1) {\n\t\t\tconst layer = layers[l];\n\n\t\t\t// Ensure layer index is up-to-date\n\t\t\tlayer.index = l;\n\n\t\t\t// Prevent any one event from firing excessively\n\t\t\tif (params.resetFire) {\n\t\t\t\tlayer._fired = false;\n\t\t\t}\n\t\t\t// Draw layer\n\t\t\t_drawLayer($canvas, layer, l + 1);\n\t\t\t// Store list of previous masks for each layer\n\t\t\tlayer._masks = data.transforms.masks.slice(0);\n\n\t\t\t// Allow image layers to load before drawing successive layers\n\t\t\tif (layer._method === $.fn.drawImage && layer.visible) {\n\t\t\t\tisImageLayer = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// If layer is an image layer\n\t\tif (isImageLayer) {\n\t\t\t// Stop and wait for drawImage() to resume drawLayers()\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Store the latest\n\t\tconst lastIndex = l;\n\n\t\t// Run completion callback (if provided) once all layers have drawn\n\t\tif (params.complete) {\n\t\t\tparams.complete.call($canvases[e]);\n\t\t\tdelete data.drawLayersComplete;\n\t\t}\n\n\t\t// Get first layer that intersects with event coordinates\n\t\tconst layer = _getIntersectingLayer(data);\n\n\t\tconst eventCache = data.event;\n\t\tlet eventType = eventCache.type;\n\n\t\t// If jCanvas has detected a dragstart\n\t\tif (data.drag.layer && eventType) {\n\t\t\t// Handle dragging of layer\n\t\t\t_handleLayerDrag($canvas, data, eventType);\n\t\t}\n\n\t\t// Manage mouseout event\n\t\tconst lastLayer = data.lastIntersected;\n\t\tif (\n\t\t\tlastLayer !== null &&\n\t\t\tlayer !== lastLayer &&\n\t\t\tlastLayer._hovered &&\n\t\t\t!lastLayer._fired &&\n\t\t\t!data.drag.dragging\n\t\t) {\n\t\t\tdata.lastIntersected = null;\n\t\t\tlastLayer._fired = true;\n\t\t\tlastLayer._hovered = false;\n\t\t\t_triggerLayerEvent($canvas, data, lastLayer, \"mouseout\");\n\t\t\t_resetCursor($canvas, data);\n\t\t}\n\n\t\tif (layer && eventType) {\n\t\t\t// Use mouse event callbacks if no touch event callbacks are given\n\t\t\tif (!layer[eventType as keyof JCanvasLayer]) {\n\t\t\t\teventType = _getMouseEventName(eventType);\n\t\t\t}\n\n\t\t\t// Check events for intersecting layer\n\t\t\tif (layer._event && layer.intersects) {\n\t\t\t\tdata.lastIntersected = layer;\n\n\t\t\t\t// Detect mouseover events\n\t\t\t\tif (\n\t\t\t\t\t(layer.mouseover || layer.mouseout || layer.cursors) &&\n\t\t\t\t\t!data.drag.dragging\n\t\t\t\t) {\n\t\t\t\t\tif (!layer._hovered && !layer._fired) {\n\t\t\t\t\t\t// Prevent events from firing excessively\n\t\t\t\t\t\tlayer._fired = true;\n\t\t\t\t\t\tlayer._hovered = true;\n\t\t\t\t\t\t_triggerLayerEvent($canvas, data, layer, \"mouseover\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Detect any other mouse event\n\t\t\t\tif (!layer._fired) {\n\t\t\t\t\t// Prevent event from firing twice unintentionally\n\t\t\t\t\tlayer._fired = true;\n\t\t\t\t\teventCache.type = null;\n\n\t\t\t\t\t_triggerLayerEvent($canvas, data, layer, eventType);\n\t\t\t\t}\n\n\t\t\t\t// Use the mousedown event to start drag\n\t\t\t\tif (\n\t\t\t\t\tlayer.draggable &&\n\t\t\t\t\t!layer.disableEvents &&\n\t\t\t\t\t(eventType === \"mousedown\" || eventType === \"touchstart\")\n\t\t\t\t) {\n\t\t\t\t\t// Keep track of drag state\n\t\t\t\t\tdata.drag.layer = layer;\n\t\t\t\t\tdata.originalRedrawOnMousemove = data.redrawOnMousemove;\n\t\t\t\t\tdata.redrawOnMousemove = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If cursor is not intersecting with any layer\n\t\t\tif (layer === null && !data.drag.dragging) {\n\t\t\t\t// Reset cursor to previous state\n\t\t\t\t_resetCursor($canvas, data);\n\t\t\t}\n\n\t\t\t// If the last layer has been drawn\n\t\t\tif (lastIndex === layers.length) {\n\t\t\t\t// Reset list of intersecting layers\n\t\t\t\tdata.intersecting.length = 0;\n\t\t\t\t// Reset transformation stack\n\t\t\t\tdata.transforms = _cloneTransforms(baseTransforms);\n\t\t\t\tdata.savedTransforms.length = 0;\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Add a jCanvas layer (internal)\nfunction _addLayer(\n\tcanvas: HTMLCanvasElement,\n\tparams: JCanvasObject,\n\targs?: Partial<JCanvasObject>,\n\tmethod?: (_args: JCanvasObject) => JQuery<HTMLElement>\n): JCanvasObject {\n\tconst layer: JCanvasObject = params._layer ? (args as JCanvasLayer) : params;\n\n\t// Store arguments object for later use\n\tparams._args = args;\n\n\t// Convert all draggable drawings into jCanvas layers\n\tif (params.draggable || params.dragGroups) {\n\t\tparams.layer = true;\n\t\tparams.draggable = true;\n\t}\n\n\t// Determine the layer's type using the available information\n\tif (!params._method) {\n\t\tif (method) {\n\t\t\tparams._method = method;\n\t\t} else if (params.method) {\n\t\t\tparams._method = $.fn[params.method];\n\t\t} else if (params.type) {\n\t\t\tparams._method = $.fn[maps.drawings[params.type] as keyof JQuery];\n\t\t}\n\t}\n\n\t// If layer hasn't been added yet\n\tif (params.layer && !params._layer && layer) {\n\t\t// Add layer to canvas\n\n\t\tconst $canvas = $(canvas);\n\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst layers = data.layers;\n\n\t\t// Do not add duplicate layers of same name\n\t\tif (\n\t\t\tlayer.name === null ||\n\t\t\t(isString(layer.name) && data.layer.names[layer.name] === undefined)\n\t\t) {\n\t\t\t// Convert number properties to numbers\n\t\t\t_coerceNumericProps(params);\n\n\t\t\t// Ensure layers are unique across canvases by cloning them\n\t\t\tconst newLayer = new jCanvasLayer(canvas, params);\n\t\t\tnewLayer.canvas = canvas;\n\t\t\t// Indicate that this is a layer for future checks\n\t\t\tnewLayer.layer = true;\n\t\t\tnewLayer._layer = true;\n\t\t\tnewLayer._running = {};\n\t\t\t// If layer stores user-defined data\n\t\t\tif (newLayer.data !== null) {\n\t\t\t\t// Clone object\n\t\t\t\tnewLayer.data = extendObject({}, newLayer.data);\n\t\t\t} else {\n\t\t\t\t// Otherwise, create data object\n\t\t\t\tnewLayer.data = {};\n\t\t\t}\n\t\t\t// If layer stores a list of associated groups\n\t\t\tif (newLayer.groups) {\n\t\t\t\t// Clone list\n\t\t\t\tnewLayer.groups = newLayer.groups.slice(0);\n\t\t\t} else {\n\t\t\t\t// Otherwise, create empty list\n\t\t\t\tnewLayer.groups = [];\n\t\t\t}\n\n\t\t\t// Update layer group maps\n\t\t\t_updateLayerName(data, newLayer);\n\t\t\t_updateLayerGroups(data, newLayer);\n\n\t\t\t// Check for any associated jCanvas events and enable them\n\t\t\t_addLayerEvents($canvas, data, newLayer);\n\n\t\t\t// Optionally enable drag-and-drop support and cursor support\n\t\t\t_enableDrag($canvas, data, newLayer);\n\n\t\t\t// Copy _event property to parameters object\n\t\t\tparams._event = newLayer._event;\n\n\t\t\t// Calculate width/height for text layers\n\t\t\tif (newLayer._method === $.fn.drawText) {\n\t\t\t\t$canvas.measureText(newLayer);\n\t\t\t}\n\n\t\t\t// Add layer to end of array if no index is specified\n\t\t\tif (newLayer.index === null) {\n\t\t\t\tnewLayer.index = layers.length;\n\t\t\t}\n\n\t\t\t// Add layer to layers array at specified index\n\t\t\tlayers.splice(newLayer.index, 0, newLayer);\n\n\t\t\t// Store layer on parameters object\n\t\t\tparams._args = newLayer;\n\n\t\t\t// Trigger an 'add' event\n\t\t\t_triggerLayerEvent($canvas, data, newLayer, \"add\");\n\t\t\treturn newLayer;\n\t\t}\n\t} else if (!params.layer) {\n\t\t_coerceNumericProps(params);\n\t}\n\n\treturn layer;\n}\n\n// Add a jCanvas layer\n$.fn.addLayer = function addLayer(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\tparams.layer = true;\n\t\t_addLayer(canvas, params, args);\n\t}\n\treturn $canvases;\n};\n\n/* Animation API */\n\n// Hide/show jCanvas/CSS properties so they can be animated using jQuery\nfunction _showProps(obj: Partial<JCanvasObject>) {\n\tfor (let p = 0; p < css.props.length; p += 1) {\n\t\tconst cssProp = css.props[p];\n\t\tobj[cssProp as keyof typeof obj] = obj[(\"_\" + cssProp) as `_${string}`];\n\t}\n}\nfunction _hideProps(obj: Partial<JCanvasObject>, reset?: boolean) {\n\tfor (let p = 0; p < css.props.length; p += 1) {\n\t\tconst cssProp = css.props[p];\n\t\t// Hide property using same name with leading underscore\n\t\tif (obj[cssProp as keyof typeof obj] !== undefined) {\n\t\t\tobj[(\"_\" + cssProp) as `_${string}`] = obj[cssProp as keyof typeof obj];\n\t\t\tcss.propsObj[cssProp] = true;\n\t\t\tif (reset) {\n\t\t\t\tdelete obj[cssProp as keyof typeof obj];\n\t\t\t}\n\t\t}\n\t}\n}\n\n// Evaluate property values that are functions\nfunction _parseEndValues(\n\tcanvas: HTMLCanvasElement,\n\tlayer: JCanvasLayer,\n\tendValues: Record<string, any>\n) {\n\t// Loop through all properties in map of end values\n\tfor (const propName in endValues) {\n\t\tif (Object.prototype.hasOwnProperty.call(endValues, propName)) {\n\t\t\tconst propValue = endValues[propName];\n\t\t\t// If end value is function\n\t\t\tif (isFunction(propValue)) {\n\t\t\t\t// Call function and use its value as the end value\n\t\t\t\tendValues[propName] = propValue.call(canvas, layer, propName);\n\t\t\t}\n\t\t\t// If end value is an object\n\t\t\tif (typeOf(propValue) === \"object\" && isPlainObject(propValue)) {\n\t\t\t\t// Prepare to animate properties in object\n\t\t\t\tfor (const subPropName in propValue) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(propValue, subPropName)) {\n\t\t\t\t\t\tconst subPropValue = propValue[subPropName];\n\t\t\t\t\t\t// Store property's start value at top-level of layer\n\t\t\t\t\t\tif (layer[propName as keyof JCanvasLayer] !== undefined) {\n\t\t\t\t\t\t\tlayer[(propName + \".\" + subPropName) as any] =\n\t\t\t\t\t\t\t\tlayer[propName as keyof JCanvasLayer][subPropName];\n\t\t\t\t\t\t\t// Store property's end value at top-level of end values map\n\t\t\t\t\t\t\tendValues[propName + \".\" + subPropName] = subPropValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Delete sub-property of object as it's no longer needed\n\t\t\t\tdelete endValues[propName];\n\t\t\t}\n\t\t}\n\t}\n\treturn endValues;\n}\n\n// Remove sub-property aliases from layer object\nfunction _removeSubPropAliases(layer: JCanvasLayer) {\n\tfor (const propName in layer) {\n\t\tif (Object.prototype.hasOwnProperty.call(layer, propName)) {\n\t\t\tif (propName.indexOf(\".\") !== -1) {\n\t\t\t\tdelete layer[propName as keyof JCanvasLayer];\n\t\t\t}\n\t\t}\n\t}\n}\n\n// Convert the given color to a normalized RGB/RGBA color string\nfunction _normalizeColor(color: string) {\n\tif (color === \"transparent\") {\n\t\t// Deal with complete transparency\n\t\treturn \"rgba(0, 0, 0, 0)\";\n\t} else if (color.match(/^([a-z]+|#[0-9a-f]+)$/gi)) {\n\t\t// Deal with hexadecimal colors and color names (note: element must be\n\t\t// in the DOM for this to work consistently)\n\t\tconst headElem = document.head;\n\t\tconst originalColor = headElem.style.color;\n\t\theadElem.style.color = color;\n\t\tconst normalizedColor = $.css(headElem, \"color\");\n\t\theadElem.style.color = originalColor;\n\t\treturn normalizedColor;\n\t} else {\n\t\treturn color;\n\t}\n}\n\n// Convert a color value to an array of RGB values\nfunction _convertColorToRgbArray(color: string) {\n\tconst normalizedColor: string = _normalizeColor(color);\n\t// Parse RGB string\n\tif (/^rgb/gi.test(normalizedColor)) {\n\t\tconst rgbMatches: string[] = normalizedColor.match(/(\\d+(\\.\\d+)?)/gi) || [];\n\t\t// Deal with RGB percentages\n\t\tconst multiple = /%/gi.test(normalizedColor) ? 2.55 : 1;\n\t\treturn [\n\t\t\tNumber(rgbMatches[0]) * multiple,\n\t\t\tNumber(rgbMatches[1]) * multiple,\n\t\t\tNumber(rgbMatches[2]) * multiple,\n\t\t\trgbMatches[3] ? Number(rgbMatches[3]) * multiple : 1,\n\t\t];\n\t} else {\n\t\tconsole.error(`Color format unsupported: ${normalizedColor}`);\n\t\treturn [];\n\t}\n}\n\n// Blend two colors by the given percentage\nfunction _blendColors(color1: string, color2: string, percentage: number) {\n\tconst [r1, g1, b1, a1] = _convertColorToRgbArray(color1);\n\tconst [r2, g2, b2, a2] = _convertColorToRgbArray(color2);\n\n\tconst r = round(r1 + (r2 - r1) * percentage);\n\tconst g = round(g1 + (g2 - g1) * percentage);\n\tconst b = round(b1 + (b2 - b1) * percentage);\n\tconst a = a1 + (a2 - a1) * percentage;\n\n\treturn `rgba(${r}, ${g}, ${b}, ${a})`;\n}\n\n// Animate jCanvas layer\n$.fn.animateLayer = function animateLayer(...args) {\n\tconst $canvases = this;\n\n\t// Deal with all cases of argument placement\n\t/*\n\t\t0. layer name/index\n\t\t1. properties\n\t\t2. duration/options\n\t\t3. easing\n\t\t4. complete function\n\t\t5. step function\n\t*/\n\n\tif (!args.length) {\n\t\treturn $canvases;\n\t}\n\n\tif (typeOf(args[2]) === \"object\") {\n\t\t// Accept an options object for animation\n\t\targs.splice(2, 0, args[2].duration || null);\n\t\targs.splice(3, 0, args[3].easing || null);\n\t\targs.splice(4, 0, args[4].complete || null);\n\t\targs.splice(5, 0, args[5].step || null);\n\t} else {\n\t\tif (args[2] === undefined) {\n\t\t\t// If object is the last argument\n\t\t\targs.splice(2, 0, null);\n\t\t\targs.splice(3, 0, null);\n\t\t\targs.splice(4, 0, null);\n\t\t} else if (isFunction(args[2])) {\n\t\t\t// If callback comes after object\n\t\t\targs.splice(2, 0, null);\n\t\t\targs.splice(3, 0, null);\n\t\t}\n\t\tif (args[3] === undefined) {\n\t\t\t// If duration is the last argument\n\t\t\targs[3] = null;\n\t\t\targs.splice(4, 0, null);\n\t\t} else if (isFunction(args[3])) {\n\t\t\t// If callback comes after duration\n\t\t\targs.splice(3, 0, null);\n\t\t}\n\t}\n\n\t// Run callback function when animation completes\n\tfunction complete(\n\t\t$canvas: JQuery<HTMLCanvasElement>,\n\t\tdata: JCanvasInternalData,\n\t\tlayer: JCanvasLayer\n\t) {\n\t\treturn function () {\n\t\t\t_showProps(layer);\n\t\t\t_removeSubPropAliases(layer);\n\n\t\t\t// Prevent multiple redraw loops\n\t\t\tif (!data.animating || data.animated === layer) {\n\t\t\t\t// Redraw layers on last frame\n\t\t\t\t$canvas.drawLayers();\n\t\t\t}\n\n\t\t\t// Signify the end of an animation loop\n\t\t\tlayer._animating = false;\n\t\t\tdata.animating = false;\n\t\t\tdata.animated = null;\n\n\t\t\t// If callback is defined\n\t\t\tif (args[4]) {\n\t\t\t\t// Run callback at the end of the animation\n\t\t\t\targs[4].call($canvas[0], layer);\n\t\t\t}\n\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"animateend\");\n\t\t};\n\t}\n\n\t// Redraw layers on every frame of the animation\n\tfunction step(\n\t\t$canvas: JQuery<HTMLCanvasElement>,\n\t\tdata: JCanvasInternalData,\n\t\tlayer: JCanvasLayer\n\t) {\n\t\treturn function (now: any, fx: any) {\n\t\t\tlet parts,\n\t\t\t\tpropName,\n\t\t\t\tsubPropName,\n\t\t\t\thidden = false;\n\n\t\t\t// If animated property has been hidden\n\t\t\tif (fx.prop[0] === \"_\") {\n\t\t\t\thidden = true;\n\t\t\t\t// Unhide property temporarily\n\t\t\t\tfx.prop = fx.prop.replace(\"_\", \"\");\n\t\t\t\tlayer[fx.prop] = layer[(\"_\" + fx.prop) as keyof JCanvasLayer];\n\t\t\t}\n\n\t\t\t// If animating property of sub-object\n\t\t\tif (fx.prop.indexOf(\".\") !== -1) {\n\t\t\t\tparts = fx.prop.split(\".\");\n\t\t\t\tpropName = parts[0];\n\t\t\t\tsubPropName = parts[1];\n\t\t\t\tif (layer[propName as keyof JCanvasLayer]) {\n\t\t\t\t\tlayer[propName as keyof JCanvasLayer][subPropName] = fx.now;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Throttle animation to improve efficiency\n\t\t\tif (layer._pos !== fx.pos) {\n\t\t\t\tlayer._pos = fx.pos;\n\n\t\t\t\t// Signify the start of an animation loop\n\t\t\t\tif (!layer._animating && !data.animating) {\n\t\t\t\t\tlayer._animating = true;\n\t\t\t\t\tdata.animating = true;\n\t\t\t\t\tdata.animated = layer;\n\t\t\t\t}\n\n\t\t\t\t// Prevent multiple redraw loops\n\t\t\t\tif (!data.animating || data.animated === layer) {\n\t\t\t\t\t// Redraw layers for every frame\n\t\t\t\t\t$canvas.drawLayers();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If callback is defined\n\t\t\tif (args[5]) {\n\t\t\t\t// Run callback for each step of animation\n\t\t\t\targs[5].call($canvas[0], now, fx, layer);\n\t\t\t}\n\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"animate\", fx);\n\n\t\t\t// If property should be hidden during animation\n\t\t\tif (hidden) {\n\t\t\t\t// Hide property again\n\t\t\t\tfx.prop = \"_\" + fx.prop;\n\t\t\t}\n\t\t};\n\t}\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\t// If a layer object was passed, use it the layer to be animated\n\t\tconst layer = $canvas.getLayer(args[0]);\n\n\t\t// Ignore layers that are functions\n\t\tif (layer && layer._method !== $.fn.draw) {\n\t\t\t// Do not modify original object\n\t\t\tconst props = _parseEndValues(canvas, layer, extendObject({}, args[1]));\n\n\t\t\t// Bypass jQuery CSS Hooks for CSS properties (width, opacity, etc.)\n\t\t\t_hideProps(props, true);\n\t\t\t_hideProps(layer);\n\n\t\t\t// Fix for jQuery's vendor prefixing support, which affects how width/height/opacity are animated\n\t\t\tlayer.style = css.propsObj;\n\n\t\t\t// Animate layer\n\t\t\t$(layer).animate(props, {\n\t\t\t\tduration: args[2],\n\t\t\t\teasing: $.easing[args[3]] ? args[3] : null,\n\t\t\t\t// When animation completes\n\t\t\t\tcomplete: complete($canvas, data, layer),\n\t\t\t\t// Redraw canvas for every animation frame\n\t\t\t\tstep: step($canvas, data, layer),\n\t\t\t});\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"animatestart\");\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Animate all layers in a layer group\n$.fn.animateLayerGroup = function animateLayerGroup(groupId, props, ...args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst $canvas = $($canvases[e]);\n\t\tconst group = $canvas.getLayerGroup(groupId);\n\t\tif (group) {\n\t\t\t// Animate all layers in the group\n\t\t\tfor (let l = 0; l < group.length; l += 1) {\n\t\t\t\t// Replace first argument with layer\n\t\t\t\targs[0] = group[l];\n\t\t\t\t$canvas.animateLayer.apply($canvas, [props, ...args]);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Delay layer animation by a given number of milliseconds\n$.fn.delayLayer = function delayLayer(layerId, duration) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst layer = $canvas.getLayer(layerId);\n\t\t// If layer exists\n\t\tif (layer) {\n\t\t\t// Delay animation\n\t\t\t$(layer).delay(duration || 0);\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"delay\");\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Delay animation all layers in a layer group\n$.fn.delayLayerGroup = function delayLayerGroup(groupId, duration) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst $canvas = $($canvases[e]);\n\n\t\tconst group = $canvas.getLayerGroup(groupId);\n\t\t// Delay all layers in the group\n\t\tif (group) {\n\t\t\tfor (let l = 0; l < group.length; l += 1) {\n\t\t\t\t// Delay each layer in the group\n\t\t\t\t$canvas.delayLayer(group[l], duration || 0);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Stop layer animation\n$.fn.stopLayer = function stopLayer(layerId, clearQueue) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst $canvas = $(canvas);\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst layer = $canvas.getLayer(layerId);\n\t\t// If layer exists\n\t\tif (layer) {\n\t\t\t// Stop animation\n\t\t\t$(layer).stop(clearQueue);\n\t\t\t_triggerLayerEvent($canvas, data, layer, \"stop\");\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Stop animation of all layers in a layer group\n$.fn.stopLayerGroup = function stopLayerGroup(groupId, clearQueue) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst $canvas = $($canvases[e]);\n\n\t\tconst group = $canvas.getLayerGroup(groupId);\n\t\t// Stop all layers in the group\n\t\tif (group) {\n\t\t\tfor (let l = 0; l < group.length; l += 1) {\n\t\t\t\t// Stop each layer in the group\n\t\t\t\tconst layer = group[l];\n\t\t\t\t$canvas.stopLayer(layer, clearQueue);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Enable animation for color properties\nfunction _supportColorProps(props: string[]) {\n\tfor (let p = 0; p < props.length; p += 1) {\n\t\t($.Tween.propHooks as JCanvasPropHooks)[props[p]] = {\n\t\t\tget: function (tween) {\n\t\t\t\treturn tween.elem[tween.prop as keyof typeof tween.elem];\n\t\t\t},\n\t\t\tset: function (tween) {\n\t\t\t\ttween.elem[tween.prop as any] = _blendColors(\n\t\t\t\t\ttween.start as any,\n\t\t\t\t\ttween.end as any,\n\t\t\t\t\ttween.pos || 0\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t}\n}\n\n// Enable animation for color properties\n_supportColorProps([\n\t\"color\",\n\t\"backgroundColor\",\n\t\"borderColor\",\n\t\"borderTopColor\",\n\t\"borderRightColor\",\n\t\"borderBottomColor\",\n\t\"borderLeftColor\",\n\t\"fillStyle\",\n\t\"outlineColor\",\n\t\"strokeStyle\",\n\t\"shadowColor\",\n]);\n\n/* Event API */\n\n// Convert mouse event name to a corresponding touch event name (if possible)\nfunction _getTouchEventName(eventName: JCanvasInteractionEventName) {\n\tconst touchEventName = maps.touchEvents[eventName];\n\tif (touchEventName) {\n\t\treturn touchEventName;\n\t}\n\treturn eventName;\n}\n// Convert touch event name to a corresponding mouse event name\nfunction _getMouseEventName(eventName: JCanvasInteractionEventName) {\n\tconst mouseEventName = maps.mouseEvents[eventName];\n\tif (mouseEventName) {\n\t\treturn mouseEventName;\n\t}\n\treturn eventName;\n}\n\n// Bind event to jCanvas layer using standard jQuery events\nfunction _createEvent(eventName: JCanvasInteractionEventName) {\n\tjCanvas.events[eventName] = function ($canvas, data) {\n\t\t// Retrieve canvas's event cache\n\t\tconst eventCache = data.event;\n\n\t\t// Both mouseover/mouseout events will be managed by a single mousemove event\n\t\tconst helperEventName =\n\t\t\teventName === \"mouseover\" || eventName === \"mouseout\"\n\t\t\t\t? \"mousemove\"\n\t\t\t\t: eventName;\n\t\tconst touchEventName = _getTouchEventName(helperEventName);\n\n\t\tfunction eventCallback(event: MouseEvent) {\n\t\t\t// Cache current mouse position and redraw layers\n\t\t\teventCache.x = event.offsetX;\n\t\t\teventCache.y = event.offsetY;\n\t\t\teventCache.type = helperEventName;\n\t\t\teventCache.event = event;\n\t\t\t// Redraw layers on every trigger of the event; don't redraw if at\n\t\t\t// least one layer is draggable and there are no layers with\n\t\t\t// explicit mouseover/mouseout/mousemove events\n\t\t\tif (\n\t\t\t\tevent.type !== \"mousemove\" ||\n\t\t\t\tdata.redrawOnMousemove ||\n\t\t\t\tdata.drag.dragging\n\t\t\t) {\n\t\t\t\t$canvas.drawLayers({\n\t\t\t\t\tresetFire: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\t// Prevent default event behavior\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\t// Ensure the event is not bound more than once\n\t\tif (!data.events[helperEventName]) {\n\t\t\t// Bind one canvas event which handles all layer events of that type\n\t\t\tif (touchEventName !== helperEventName) {\n\t\t\t\t$canvas.on(\n\t\t\t\t\thelperEventName + \".jCanvas \" + touchEventName + \".jCanvas\",\n\t\t\t\t\teventCallback as JQuery.EventHandlerBase<HTMLElement, object>\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t$canvas.on(\n\t\t\t\t\thelperEventName + \".jCanvas\",\n\t\t\t\t\teventCallback as JQuery.EventHandlerBase<HTMLElement, object>\n\t\t\t\t);\n\t\t\t}\n\t\t\t// Prevent this event from being bound twice\n\t\t\tdata.events[helperEventName] = true;\n\t\t}\n\t};\n}\nfunction _createEvents(eventNames: JCanvasInteractionEventName[]) {\n\tfor (let n = 0; n < eventNames.length; n += 1) {\n\t\t_createEvent(eventNames[n]);\n\t}\n}\n// Populate jCanvas events object with some standard events\n_createEvents([\n\t\"click\",\n\t\"dblclick\",\n\t\"mousedown\",\n\t\"mouseup\",\n\t\"mousemove\",\n\t\"mouseover\",\n\t\"mouseout\",\n\t\"touchstart\",\n\t\"touchmove\",\n\t\"touchend\",\n\t\"pointerdown\",\n\t\"pointermove\",\n\t\"pointerup\",\n\t\"contextmenu\",\n]);\n\n// Check if event fires when a drawing is drawn\nfunction _detectEvents(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject\n) {\n\t// Use the layer object stored by the given parameters object\n\tconst layer = params._args;\n\t// Canvas must have event bindings\n\tif (layer) {\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst eventCache = data.event;\n\t\tlet intersects: boolean = false;\n\t\tlet x: number;\n\t\tlet y: number;\n\t\tif (eventCache.x !== null && eventCache.y !== null) {\n\t\t\t// Respect user-defined pixel ratio\n\t\t\tx = eventCache.x * data.pixelRatio;\n\t\t\ty = eventCache.y * data.pixelRatio;\n\t\t\t// Determine if the given coordinates are in the current path\n\t\t\tif (layer._path) {\n\t\t\t\tintersects =\n\t\t\t\t\tctx.isPointInPath(layer._path, x, y) ||\n\t\t\t\t\tctx.isPointInStroke(layer._path, x, y);\n\t\t\t} else {\n\t\t\t\tintersects = ctx.isPointInPath(x, y) || ctx.isPointInStroke(x, y);\n\t\t\t}\n\t\t}\n\t\tconst transforms = data.transforms;\n\n\t\t// Allow callback functions to retrieve the mouse coordinates\n\t\tlayer.eventX = eventCache.x;\n\t\tlayer.eventY = eventCache.y;\n\t\tlayer.event = eventCache.event;\n\n\t\t// Adjust coordinates to match current canvas transformation\n\n\t\t// Keep track of some transformation values\n\t\tconst angle = data.transforms.rotate;\n\t\tx = layer.eventX;\n\t\ty = layer.eventY;\n\n\t\tif (angle !== 0) {\n\t\t\t// Rotate coordinates if coordinate space has been rotated\n\t\t\tlayer._eventX = x * cos(-angle) - y * sin(-angle);\n\t\t\tlayer._eventY = y * cos(-angle) + x * sin(-angle);\n\t\t} else {\n\t\t\t// Otherwise, no calculations need to be made\n\t\t\tlayer._eventX = x;\n\t\t\tlayer._eventY = y;\n\t\t}\n\n\t\t// Scale coordinates\n\t\tlayer._eventX /= transforms.scaleX;\n\t\tlayer._eventY /= transforms.scaleY;\n\n\t\t// If layer intersects with cursor\n\t\tif (intersects) {\n\t\t\t// Add it to a list of layers that intersect with cursor\n\t\t\tdata.intersecting.push(layer);\n\t\t}\n\t\tlayer.intersects = Boolean(intersects);\n\t}\n}\n\n// Normalize offsetX and offsetY for all browsers\n// @ts-expect-error TODO: properly type extension for $.event\n$.event.fix = function (event) {\n\tevent = jQueryEventFix.call($.event, event);\n\tconst originalEvent = event.originalEvent;\n\n\t// originalEvent does not exist for manually-triggered events\n\tif (originalEvent) {\n\t\tconst touches = originalEvent.changedTouches;\n\n\t\t// If offsetX and offsetY are not supported, define them\n\t\tlet offset: JQuery.Coordinates | undefined;\n\t\tif (event.pageX !== undefined && event.offsetX === undefined) {\n\t\t\ttry {\n\t\t\t\toffset = $(event.currentTarget).offset();\n\t\t\t\tif (offset) {\n\t\t\t\t\tevent.offsetX = event.pageX - offset.left;\n\t\t\t\t\tevent.offsetY = event.pageY - offset.top;\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Fail silently\n\t\t\t}\n\t\t} else if (touches) {\n\t\t\ttry {\n\t\t\t\t// Enable offsetX and offsetY for mobile devices\n\t\t\t\toffset = $(event.currentTarget).offset();\n\t\t\t\tif (offset) {\n\t\t\t\t\tevent.offsetX = touches[0].pageX - offset.left;\n\t\t\t\t\tevent.offsetY = touches[0].pageY - offset.top;\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Fail silently\n\t\t\t}\n\t\t}\n\t}\n\treturn event;\n};\n\n/* Drawing API */\n\n// Draws on canvas using a function\n$.fn.draw = function draw(args) {\n\tconst $canvases = this;\n\tconst params = _getParamsObject(args);\n\n\t// Draw using any other method\n\tconst fn = $.fn[maps.drawings[params.type!] as keyof JQuery];\n\tif (params.type && maps.drawings[params.type] && isFunction(fn)) {\n\t\t// @ts-expect-error TODO (not sure how to fix this: \"This expression is\n\t\t// not callable. Each member of the union type '...' has signatures, but\n\t\t// none of those signatures are compatible with each other.\")\n\t\tfn.call($canvases, args);\n\t} else {\n\t\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\t\tconst canvas = $canvases[e];\n\t\t\tif (!_isCanvas(canvas)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst ctx = _getContext(canvas);\n\t\t\tif (!ctx) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst params = _getParamsObject(args);\n\t\t\t_addLayer(canvas, params, args, draw);\n\t\t\tif (!params.visible) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (params.fn) {\n\t\t\t\t// Call the given user-defined function\n\t\t\t\tparams.fn.call($canvases[e], ctx, params);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Clears canvas\n$.fn.clearCanvas = function clearCanvas(args) {\n\tconst $canvases = this;\n\tconst params = _getParamsObject(args);\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (params.width === null || params.height === null) {\n\t\t\t// Clear entire canvas if width/height is not given\n\n\t\t\t// Reset current transformation temporarily to ensure that the entire canvas is cleared\n\t\t\tctx.save();\n\t\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tctx.clearRect(0, 0, canvas.width, canvas.height);\n\t\t\tctx.restore();\n\t\t} else {\n\t\t\t// Otherwise, clear the defined section of the canvas\n\n\t\t\t// Transform clear rectangle\n\t\t\t_addLayer(canvas, params, args, clearCanvas);\n\t\t\t_transformShape(canvas, ctx, params, params.width, params.height);\n\t\t\tctx.clearRect(\n\t\t\t\tparams.x - params.width / 2,\n\t\t\t\tparams.y - params.height / 2,\n\t\t\t\tparams.width,\n\t\t\t\tparams.height\n\t\t\t);\n\t\t\t// Restore previous transformation\n\t\t\t_restoreTransform(ctx, params);\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n/* Transformation API */\n\n// Restores canvas\n$.fn.saveCanvas = function saveCanvas(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, saveCanvas);\n\n\t\t// Restore a number of times using the given count\n\t\tfor (let i = 0; i < params.count; i += 1) {\n\t\t\t_saveCanvas(ctx, data);\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Restores canvas\n$.fn.restoreCanvas = function restoreCanvas(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, restoreCanvas);\n\n\t\t// Restore a number of times using the given count\n\t\tfor (let i = 0; i < params.count; i += 1) {\n\t\t\t_restoreCanvas(ctx, data);\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Rotates canvas (internal)\nfunction _rotateCanvas(\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\ttransforms: JCanvasBaseTransforms | null\n) {\n\t// Get conversion factor for radians\n\tparams._toRad = params.inDegrees ? PI / 180 : 1;\n\n\t// Rotate canvas using shape as center of rotation\n\tctx.translate(params.x, params.y);\n\tctx.rotate(params.rotate * params._toRad);\n\tctx.translate(-params.x, -params.y);\n\n\t// If transformation data was given\n\tif (transforms) {\n\t\t// Update transformation data\n\t\ttransforms.rotate += params.rotate * params._toRad;\n\t}\n}\n\n// Scales canvas (internal)\nfunction _scaleCanvas(\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\ttransforms: JCanvasBaseTransforms | null\n) {\n\t// Scale both the x- and y- axis using the 'scale' property\n\tif (params.scale !== 1) {\n\t\tparams.scaleX = params.scaleY = params.scale;\n\t}\n\n\t// Scale canvas using shape as center of rotation\n\tctx.translate(params.x, params.y);\n\tctx.scale(params.scaleX, params.scaleY);\n\tctx.translate(-params.x, -params.y);\n\n\t// If transformation data was given\n\tif (transforms) {\n\t\t// Update transformation data\n\t\ttransforms.scaleX *= params.scaleX;\n\t\ttransforms.scaleY *= params.scaleY;\n\t}\n}\n\n// Translates canvas (internal)\nfunction _translateCanvas(\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\ttransforms: JCanvasBaseTransforms | null\n) {\n\t// Translate both the x- and y-axis using the 'translate' property\n\tif (params.translate) {\n\t\tparams.translateX = params.translateY = params.translate;\n\t}\n\n\t// Translate canvas\n\tctx.translate(params.translateX, params.translateY);\n\n\t// If transformation data was given\n\tif (transforms) {\n\t\t// Update transformation data\n\t\ttransforms.translateX += params.translateX;\n\t\ttransforms.translateY += params.translateY;\n\t}\n}\n\n// Rotates canvas\n$.fn.rotateCanvas = function rotateCanvas(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, rotateCanvas);\n\n\t\t// Autosave transformation state by default\n\t\tif (params.autosave) {\n\t\t\t// Automatically save transformation state by default\n\t\t\t_saveCanvas(ctx, data);\n\t\t}\n\t\t_rotateCanvas(ctx, params, data.transforms);\n\t}\n\treturn $canvases;\n};\n\n// Scales canvas\n$.fn.scaleCanvas = function scaleCanvas(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, scaleCanvas);\n\n\t\t// Autosave transformation state by default\n\t\tif (params.autosave) {\n\t\t\t// Automatically save transformation state by default\n\t\t\t_saveCanvas(ctx, data);\n\t\t}\n\t\t_scaleCanvas(ctx, params, data.transforms);\n\t}\n\treturn $canvases;\n};\n\n// Translates canvas\n$.fn.translateCanvas = function translateCanvas(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, translateCanvas);\n\n\t\t// Autosave transformation state by default\n\t\tif (params.autosave) {\n\t\t\t// Automatically save transformation state by default\n\t\t\t_saveCanvas(ctx, data);\n\t\t}\n\t\t_translateCanvas(ctx, params, data.transforms);\n\t}\n\treturn $canvases;\n};\n\n/* Shape API */\n\n// Draws rectangle\n$.fn.drawRect = function drawRect(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawRect);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params, params.width, params.height);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\tconst nonNullWidth = params.width || 0;\n\t\tconst nonNullHeight = params.height || 0;\n\t\tctx.beginPath();\n\t\tconst x1 = params.x - nonNullWidth / 2;\n\t\tconst y1 = params.y - nonNullHeight / 2;\n\t\tconst r = abs(params.cornerRadius);\n\t\t// If corner radius is defined and is not zero\n\t\tif (r) {\n\t\t\t// Draw rectangle with rounded corners if cornerRadius is defined\n\t\t\tctx.roundRect(x1, y1, nonNullWidth, nonNullHeight, r);\n\t\t} else {\n\t\t\t// Otherwise, draw rectangle with square corners\n\t\t\tctx.rect(x1, y1, nonNullWidth, nonNullHeight);\n\t\t}\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Close rectangle path\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Retrieves a coterminal angle between 0 and 2pi for the given angle\nfunction _getCoterminal(angle: number) {\n\twhile (angle < 0) {\n\t\tangle += 2 * PI;\n\t}\n\treturn angle;\n}\n\n// Retrieves the x-coordinate for the given angle in an arc/ellipse\nfunction _getConicX(x: number, radiusX: number, angle: number) {\n\treturn x + radiusX * cos(angle);\n}\n// Retrieves the y-coordinate for the given angle in an arc/ellipse\nfunction _getConicY(y: number, radiusY: number, angle: number) {\n\treturn y + radiusY * sin(angle);\n}\n\n// Calculate angles and positioning for arcs/ellipses\nfunction _getConicOffsets(params: JCanvasObject, path: JCanvasObject) {\n\t// Determine offset from dragging\n\tconst offsetX = params === path ? 0 : params.x;\n\tconst offsetY = params === path ? 0 : params.y;\n\t// Ensure arrows are pointed correctly for CCW arcs\n\tconst angleDiff = path.ccw ? -PI / 180 : PI / 180;\n\n\tconst pathX = path.x + offsetX;\n\tconst pathY = path.y + offsetY;\n\n\t// Convert angles to radians, then offset to make 0deg due north of arc\n\tconst pathStartAngle = path.start * params._toRad - PI / 2;\n\tconst pathEndAngle =\n\t\t!path.inDegrees && path.end === 360\n\t\t\t? PI * 2\n\t\t\t: path.end * params._toRad - PI / 2;\n\n\treturn { pathX, pathY, angleDiff, pathStartAngle, pathEndAngle };\n}\n\n// Draws arc (internal)\nfunction _drawArc(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject\n) {\n\tconst { pathX, pathY, angleDiff, pathStartAngle, pathEndAngle } =\n\t\t_getConicOffsets(params, path);\n\n\t// Calculate coordinates for start arrow\n\tconst x1 = _getConicX(pathX, path.radius, pathStartAngle + angleDiff);\n\tconst y1 = _getConicY(pathY, path.radius, pathStartAngle + angleDiff);\n\tconst x2 = _getConicX(pathX, path.radius, pathStartAngle);\n\tconst y2 = _getConicY(pathY, path.radius, pathStartAngle);\n\n\t_addStartArrow(canvas, ctx, params, path, x1, y1, x2, y2);\n\n\t// Draw arc\n\tctx.arc(pathX, pathY, path.radius, pathStartAngle, pathEndAngle, path.ccw);\n\n\t// Calculate coordinates for end arrow\n\tconst x3 = _getConicX(pathX, path.radius, pathEndAngle + angleDiff);\n\tconst y3 = _getConicY(pathY, path.radius, pathEndAngle + angleDiff);\n\tconst x4 = _getConicX(pathX, path.radius, pathEndAngle);\n\tconst y4 = _getConicY(pathY, path.radius, pathEndAngle);\n\n\t_addEndArrow(canvas, ctx, params, path, x4, y4, x3, y3);\n}\n\n// Draws ellipse (internal)\nfunction _drawEllipse(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject\n) {\n\tconst { pathX, pathY, angleDiff, pathStartAngle, pathEndAngle } =\n\t\t_getConicOffsets(params, path);\n\n\tconst nonNullWidth = path.width || 0;\n\tconst nonNullHeight = path.height || 0;\n\n\t// Calculate coordinates for start arrow\n\tconst x1 = _getConicX(pathX, nonNullWidth / 2, pathStartAngle + angleDiff);\n\tconst y1 = _getConicY(pathY, nonNullHeight / 2, pathStartAngle + angleDiff);\n\tconst x2 = _getConicX(pathX, nonNullWidth / 2, pathStartAngle);\n\tconst y2 = _getConicY(pathY, nonNullHeight / 2, pathStartAngle);\n\n\t_addStartArrow(canvas, ctx, params, path, x1, y1, x2, y2);\n\n\tctx.ellipse(\n\t\tpathX,\n\t\tpathY,\n\t\tnonNullWidth / 2,\n\t\tnonNullHeight / 2,\n\t\t0,\n\t\tpathStartAngle,\n\t\tpathEndAngle,\n\t\tpath.ccw\n\t);\n\n\t// Calculate coordinates for end arrow\n\tconst x3 = _getConicX(pathX, nonNullWidth / 2, pathEndAngle + angleDiff);\n\tconst y3 = _getConicY(pathY, nonNullHeight / 2, pathEndAngle + angleDiff);\n\tconst x4 = _getConicX(pathX, nonNullWidth / 2, pathEndAngle);\n\tconst y4 = _getConicY(pathY, nonNullHeight / 2, pathEndAngle);\n\n\t_addEndArrow(canvas, ctx, params, path, x4, y4, x3, y3);\n}\n\n// Draws arc or circle\n$.fn.drawArc = function drawArc(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawArc);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params, params.radius * 2);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\tctx.beginPath();\n\t\t_drawArc(canvas, ctx, params, params);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Optionally close path\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Draws ellipse\n$.fn.drawEllipse = function drawEllipse(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawEllipse);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params, params.width, params.height);\n\t\t_setGlobalProps(canvas, ctx, params);\n\t\tctx.beginPath();\n\t\t_drawEllipse(canvas, ctx, params, params);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Always close path\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Draws a regular (equal-angled) polygon\n$.fn.drawPolygon = function drawPolygon(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawPolygon);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params, params.radius * 2);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t// Polygon's central angle\n\t\tconst dtheta = (2 * PI) / params.sides;\n\t\t// Half of dtheta\n\t\tconst hdtheta = dtheta / 2;\n\t\t// Polygon's starting angle\n\t\tlet theta = hdtheta + PI / 2;\n\t\t// Distance from polygon's center to the middle of its side\n\t\tconst apothem = params.radius * cos(hdtheta);\n\n\t\t// Calculate path and draw\n\t\tctx.beginPath();\n\t\tfor (let i = 0; i < params.sides; i += 1) {\n\t\t\t// Draw side of polygon\n\t\t\tlet x = params.x + params.radius * cos(theta);\n\t\t\tlet y = params.y + params.radius * sin(theta);\n\n\t\t\t// Plot point on polygon\n\t\t\tctx.lineTo(x, y);\n\n\t\t\t// Project side if chosen\n\t\t\tif (params.concavity) {\n\t\t\t\t// Sides are projected from the polygon's apothem\n\t\t\t\tx =\n\t\t\t\t\tparams.x +\n\t\t\t\t\t(apothem + -apothem * params.concavity) * cos(theta + hdtheta);\n\t\t\t\ty =\n\t\t\t\t\tparams.y +\n\t\t\t\t\t(apothem + -apothem * params.concavity) * sin(theta + hdtheta);\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t}\n\n\t\t\t// Increment theta by delta theta\n\t\t\ttheta += dtheta;\n\t\t}\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Always close path\n\t\tparams.closed = true;\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Draws pie-shaped slice\n$.fn.drawSlice = function drawSlice(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawSlice);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params, params.radius * 2);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t// Perform extra calculations\n\n\t\t// Convert angles to radians\n\t\tparams.start *= params._toRad;\n\t\tparams.end *= params._toRad;\n\t\t// Consider 0deg at north of arc\n\t\tparams.start -= PI / 2;\n\t\tparams.end -= PI / 2;\n\n\t\t// Find positive equivalents of angles\n\t\tparams.start = _getCoterminal(params.start);\n\t\tparams.end = _getCoterminal(params.end);\n\t\t// Ensure start angle is less than end angle\n\t\tif (params.end < params.start) {\n\t\t\tparams.end += 2 * PI;\n\t\t}\n\n\t\t// Calculate angular position of slice\n\t\tconst angle = (params.start + params.end) / 2;\n\n\t\t// Calculate ratios for slice's angle\n\t\tconst dx = params.radius * params.spread * cos(angle);\n\t\tconst dy = params.radius * params.spread * sin(angle);\n\n\t\t// Adjust position of slice\n\t\tparams.x += dx;\n\t\tparams.y += dy;\n\n\t\t// Draw slice\n\t\tctx.beginPath();\n\t\tctx.arc(\n\t\t\tparams.x,\n\t\t\tparams.y,\n\t\t\tparams.radius,\n\t\t\tparams.start,\n\t\t\tparams.end,\n\t\t\tparams.ccw\n\t\t);\n\t\tctx.lineTo(params.x, params.y);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Always close path\n\t\tparams.closed = true;\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n/* Path API */\n\n// Adds arrow to path using the given properties\nfunction _addArrow(\n\t_canvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject,\n\tx1: number,\n\ty1: number,\n\tx2: number,\n\ty2: number\n) {\n\t// If arrow radius is given and path is not closed\n\tif (path.arrowRadius && !params.closed) {\n\t\t// Calculate angle\n\t\tlet angle = atan2(y2 - y1, x2 - x1);\n\t\t// Adjust angle correctly\n\t\tangle -= PI;\n\t\t// Calculate offset to place arrow at edge of path\n\t\tconst offsetX = params.strokeWidth * cos(angle);\n\t\tconst offsetY = params.strokeWidth * sin(angle);\n\n\t\t// Calculate coordinates for left half of arrow\n\t\tconst leftX = x2 + path.arrowRadius * cos(angle + path.arrowAngle / 2);\n\t\tconst leftY = y2 + path.arrowRadius * sin(angle + path.arrowAngle / 2);\n\t\t// Calculate coordinates for right half of arrow\n\t\tconst rightX = x2 + path.arrowRadius * cos(angle - path.arrowAngle / 2);\n\t\tconst rightY = y2 + path.arrowRadius * sin(angle - path.arrowAngle / 2);\n\n\t\t// Draw left half of arrow\n\t\tctx.moveTo(leftX - offsetX, leftY - offsetY);\n\t\tctx.lineTo(x2 - offsetX, y2 - offsetY);\n\t\t// Draw right half of arrow\n\t\tctx.lineTo(rightX - offsetX, rightY - offsetY);\n\n\t\t// Visually connect arrow to path\n\t\tctx.moveTo(x2 - offsetX, y2 - offsetY);\n\t\tctx.lineTo(x2 + offsetX, y2 + offsetY);\n\t\t// Move back to end of path\n\t\tctx.moveTo(x2, y2);\n\t}\n}\n\n// Optionally adds arrow to start of path\nfunction _addStartArrow(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject,\n\tx1: number,\n\ty1: number,\n\tx2: number,\n\ty2: number\n) {\n\tif (!path._arrowAngleConverted) {\n\t\tpath.arrowAngle *= params._toRad;\n\t\tpath._arrowAngleConverted = true;\n\t}\n\tif (path.startArrow) {\n\t\t_addArrow(canvas, ctx, params, path, x1, y1, x2, y2);\n\t}\n}\n\n// Optionally adds arrow to end of path\nfunction _addEndArrow(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject,\n\tx1: number,\n\ty1: number,\n\tx2: number,\n\ty2: number\n) {\n\tif (!path._arrowAngleConverted) {\n\t\tpath.arrowAngle *= params._toRad;\n\t\tpath._arrowAngleConverted = true;\n\t}\n\tif (path.endArrow) {\n\t\t_addArrow(canvas, ctx, params, path, x1, y1, x2, y2);\n\t}\n}\n\n// Draws line (internal)\nfunction _drawLine(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject\n) {\n\tlet l = 2;\n\t_addStartArrow(\n\t\tcanvas,\n\t\tctx,\n\t\tparams,\n\t\tpath,\n\t\tpath.x2 + params.x,\n\t\tpath.y2 + params.y,\n\t\tpath.x1 + params.x,\n\t\tpath.y1 + params.y\n\t);\n\tif (path.x1 !== undefined && path.y1 !== undefined) {\n\t\tctx.moveTo(path.x1 + params.x, path.y1 + params.y);\n\t}\n\twhile (true) {\n\t\t// Calculate next coordinates\n\t\tconst lx = path[(\"x\" + l) as `x${number}`];\n\t\tconst ly = path[(\"y\" + l) as `y${number}`];\n\t\t// If coordinates are given\n\t\tif (lx !== undefined && ly !== undefined) {\n\t\t\t// Draw next line\n\t\t\tctx.lineTo(lx + params.x, ly + params.y);\n\t\t\tl += 1;\n\t\t} else {\n\t\t\t// Otherwise, stop drawing\n\t\t\tbreak;\n\t\t}\n\t}\n\tl -= 1;\n\t// Optionally add arrows to path\n\t_addEndArrow(\n\t\tcanvas,\n\t\tctx,\n\t\tparams,\n\t\tpath,\n\t\tpath[(\"x\" + (l - 1)) as `x${number}`] + params.x,\n\t\tpath[(\"y\" + (l - 1)) as `y${number}`] + params.y,\n\t\tpath[(\"x\" + l) as `x${number}`] + params.x,\n\t\tpath[(\"y\" + l) as `y${number}`] + params.y\n\t);\n}\n\n// Draws line\n$.fn.drawLine = function drawLine(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawLine);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t// Draw each point\n\t\tctx.beginPath();\n\t\t_drawLine(canvas, ctx, params, params);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Optionally close path\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Draws quadratic curve (internal)\nfunction _drawQuadratic(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject\n) {\n\tlet l = 2;\n\n\t_addStartArrow(\n\t\tcanvas,\n\t\tctx,\n\t\tparams,\n\t\tpath,\n\t\tpath.cx1 + params.x,\n\t\tpath.cy1 + params.y,\n\t\tpath.x1 + params.x,\n\t\tpath.y1 + params.y\n\t);\n\n\tif (path.x1 !== undefined && path.y1 !== undefined) {\n\t\tctx.moveTo(path.x1 + params.x, path.y1 + params.y);\n\t}\n\twhile (true) {\n\t\t// Calculate next coordinates\n\t\tconst lx = path[(\"x\" + l) as `x${number}`];\n\t\tconst ly = path[(\"y\" + l) as `y${number}`];\n\t\tconst lcx = path[(\"cx\" + (l - 1)) as `cx${number}`];\n\t\tconst lcy = path[(\"cy\" + (l - 1)) as `cy${number}`];\n\t\t// If coordinates are given\n\t\tif (\n\t\t\tlx !== undefined &&\n\t\t\tly !== undefined &&\n\t\t\tlcx !== undefined &&\n\t\t\tlcy !== undefined\n\t\t) {\n\t\t\t// Draw next curve\n\t\t\tctx.quadraticCurveTo(\n\t\t\t\tlcx + params.x,\n\t\t\t\tlcy + params.y,\n\t\t\t\tlx + params.x,\n\t\t\t\tly + params.y\n\t\t\t);\n\t\t\tl += 1;\n\t\t} else {\n\t\t\t// Otherwise, stop drawing\n\t\t\tbreak;\n\t\t}\n\t}\n\tl -= 1;\n\t_addEndArrow(\n\t\tcanvas,\n\t\tctx,\n\t\tparams,\n\t\tpath,\n\t\tpath[(\"cx\" + (l - 1)) as `cx${number}`] + params.x,\n\t\tpath[(\"cy\" + (l - 1)) as `cy${number}`] + params.y,\n\t\tpath[(\"x\" + l) as `x${number}`] + params.x,\n\t\tpath[(\"y\" + l) as `y${number}`] + params.y\n\t);\n}\n\n// Draws quadratic curve\n$.fn.drawQuadratic = function drawQuadratic(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawQuadratic);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t// Draw each point\n\t\tctx.beginPath();\n\t\t_drawQuadratic(canvas, ctx, params, params);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Optionally close path\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Draws Bezier curve (internal)\nfunction _drawBezier(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject\n) {\n\tlet l = 2;\n\tlet lc = 1;\n\n\t_addStartArrow(\n\t\tcanvas,\n\t\tctx,\n\t\tparams,\n\t\tpath,\n\t\tpath.cx1 + params.x,\n\t\tpath.cy1 + params.y,\n\t\tpath.x1 + params.x,\n\t\tpath.y1 + params.y\n\t);\n\n\tif (path.x1 !== undefined && path.y1 !== undefined) {\n\t\tctx.moveTo(path.x1 + params.x, path.y1 + params.y);\n\t}\n\twhile (true) {\n\t\t// Calculate next coordinates\n\t\tconst lx = path[(\"x\" + l) as `x${number}`];\n\t\tconst ly = path[(\"y\" + l) as `y${number}`];\n\t\tconst lcx1 = path[(\"cx\" + lc) as `cx${number}`];\n\t\tconst lcy1 = path[(\"cy\" + lc) as `cy${number}`];\n\t\tconst lcx2 = path[(\"cx\" + (lc + 1)) as `cx${number}`];\n\t\tconst lcy2 = path[(\"cy\" + (lc + 1)) as `cy${number}`];\n\t\t// If next coordinates are given\n\t\tif (\n\t\t\tlx !== undefined &&\n\t\t\tly !== undefined &&\n\t\t\tlcx1 !== undefined &&\n\t\t\tlcy1 !== undefined &&\n\t\t\tlcx2 !== undefined &&\n\t\t\tlcy2 !== undefined\n\t\t) {\n\t\t\t// Draw next curve\n\t\t\tctx.bezierCurveTo(\n\t\t\t\tlcx1 + params.x,\n\t\t\t\tlcy1 + params.y,\n\t\t\t\tlcx2 + params.x,\n\t\t\t\tlcy2 + params.y,\n\t\t\t\tlx + params.x,\n\t\t\t\tly + params.y\n\t\t\t);\n\t\t\tl += 1;\n\t\t\tlc += 2;\n\t\t} else {\n\t\t\t// Otherwise, stop drawing\n\t\t\tbreak;\n\t\t}\n\t}\n\tl -= 1;\n\tlc -= 2;\n\t_addEndArrow(\n\t\tcanvas,\n\t\tctx,\n\t\tparams,\n\t\tpath,\n\t\tpath[(\"cx\" + (lc + 1)) as `cx${number}`] + params.x,\n\t\tpath[(\"cy\" + (lc + 1)) as `cy${number}`] + params.y,\n\t\tpath[(\"x\" + l) as `x${number}`] + params.x,\n\t\tpath[(\"y\" + l) as `y${number}`] + params.y\n\t);\n}\n\n// Draws Bezier curve\n$.fn.drawBezier = function drawBezier(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawBezier);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t// Draw each point\n\t\tctx.beginPath();\n\t\t_drawBezier(canvas, ctx, params, params);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Optionally close path\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Retrieves the x-coordinate for the given vector angle and length\nfunction _getVectorX(params: JCanvasObject, angle: number, length: number) {\n\tangle *= params._toRad;\n\tangle -= PI / 2;\n\treturn length * cos(angle);\n}\n// Retrieves the y-coordinate for the given vector angle and length\nfunction _getVectorY(params: JCanvasObject, angle: number, length: number) {\n\tangle *= params._toRad;\n\tangle -= PI / 2;\n\treturn length * sin(angle);\n}\n\n// Draws vector (internal) #2\nfunction _drawVector(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tpath: JCanvasObject\n) {\n\t// Determine offset from dragging\n\tlet offsetX: number;\n\tlet offsetY: number;\n\tif (params === path) {\n\t\toffsetX = 0;\n\t\toffsetY = 0;\n\t} else {\n\t\toffsetX = params.x;\n\t\toffsetY = params.y;\n\t}\n\n\tlet l = 1;\n\tconst x = path.x + offsetX;\n\tlet x3 = x;\n\tlet x4 = x;\n\tconst y = path.y + offsetY;\n\tlet y3 = y;\n\tlet y4 = y;\n\n\t_addStartArrow(\n\t\tcanvas,\n\t\tctx,\n\t\tparams,\n\t\tpath,\n\t\tx + _getVectorX(params, path.a1, path.l1),\n\t\ty + _getVectorY(params, path.a1, path.l1),\n\t\tx,\n\t\ty\n\t);\n\n\t// The vector starts at the given (x, y) coordinates\n\tif (path.x !== undefined && path.y !== undefined) {\n\t\tctx.moveTo(x, y);\n\t}\n\twhile (true) {\n\t\tconst angle = path[(\"a\" + l) as `a${number}`];\n\t\tconst length = path[(\"l\" + l) as `l${number}`];\n\n\t\tif (angle !== undefined && length !== undefined) {\n\t\t\t// Convert the angle to radians with 0 degrees starting at north\n\t\t\t// Keep track of last two coordinates\n\t\t\tx3 = x4;\n\t\t\ty3 = y4;\n\t\t\t// Compute (x, y) coordinates from angle and length\n\t\t\tx4 += _getVectorX(params, angle, length);\n\t\t\ty4 += _getVectorY(params, angle, length);\n\t\t\tctx.lineTo(x4, y4);\n\t\t\tl += 1;\n\t\t} else {\n\t\t\t// Otherwise, stop drawing\n\t\t\tbreak;\n\t\t}\n\t}\n\t_addEndArrow(canvas, ctx, params, path, x3, y3, x4, y4);\n}\n\n// Draws vector\n$.fn.drawVector = function drawVector(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawVector);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t// Draw each point\n\t\tctx.beginPath();\n\t\t_drawVector(canvas, ctx, params, params);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Optionally close path\n\t\t_closePath(canvas, ctx, params);\n\t}\n\treturn $canvases;\n};\n\n// Draws a path consisting of one or more subpaths\n$.fn.drawPath = function drawPath(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\tif (params.d) {\n\t\t\t// The only way to offset an SVG path drawn with Path2D() is to\n\t\t\t// translate it (making sure we undo the translation it at the end\n\t\t\t// of the method); note that we cannot use ctx.save() and\n\t\t\t// ctx.restore() because it would cause any masking to be undone at\n\t\t\t// the end of the drawPath() code\n\t\t\tctx.translate(params.x, params.y);\n\t\t\tparams._path = caches.pathCache[params.d] || new Path2D(params.d);\n\t\t\tcaches.pathCache[params.d] = params._path;\n\t\t}\n\t\t_addLayer(canvas, params, args, drawPath);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t_transformShape(canvas, ctx, params);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\tif (!params.d) {\n\t\t\tctx.beginPath();\n\t\t\tlet l = 1;\n\t\t\twhile (true) {\n\t\t\t\tlet lp = params[(\"p\" + l) as keyof typeof params];\n\t\t\t\tif (lp !== undefined) {\n\t\t\t\t\tlp = new jCanvasObject(lp);\n\t\t\t\t\tif (lp.type === \"line\") {\n\t\t\t\t\t\t_drawLine(canvas, ctx, params, lp);\n\t\t\t\t\t} else if (lp.type === \"quadratic\") {\n\t\t\t\t\t\t_drawQuadratic(canvas, ctx, params, lp);\n\t\t\t\t\t} else if (lp.type === \"bezier\") {\n\t\t\t\t\t\t_drawBezier(canvas, ctx, params, lp);\n\t\t\t\t\t} else if (lp.type === \"vector\") {\n\t\t\t\t\t\t_drawVector(canvas, ctx, params, lp);\n\t\t\t\t\t} else if (lp.type === \"arc\") {\n\t\t\t\t\t\t_drawArc(canvas, ctx, params, lp);\n\t\t\t\t\t} else if (lp.type === \"ellipse\") {\n\t\t\t\t\t\t_drawEllipse(canvas, ctx, params, lp);\n\t\t\t\t\t}\n\t\t\t\t\tl += 1;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Optionally close path\n\t\t_closePath(canvas, ctx, params);\n\n\t\t// Remember to restore the earlier translation\n\t\tif (params.d) {\n\t\t\tctx.translate(-params.x, -params.y);\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n/* Text API */\n\n// Calculates font string and set it as the canvas font\nfunction _setCanvasFont(\n\t_canvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject\n) {\n\t// Otherwise, use the given font attributes\n\tif (!isNaN(Number(params.fontSize))) {\n\t\t// Give font size units if it doesn't have any\n\t\tparams.fontSize += \"px\";\n\t}\n\t// Set font using given font properties\n\tctx.font = params.fontStyle + \" \" + params.fontSize + \" \" + params.fontFamily;\n}\n\n// Measures canvas text\nfunction _measureText(\n\tcanvas: HTMLCanvasElement,\n\tctx: CanvasRenderingContext2D,\n\tparams: JCanvasObject,\n\tlines: string[]\n) {\n\tconst propCache = caches.propCache;\n\n\t// Used cached width/height if possible\n\tif (\n\t\tpropCache.width &&\n\t\tpropCache.height &&\n\t\tpropCache.text === params.text &&\n\t\tpropCache.fontStyle === params.fontStyle &&\n\t\tpropCache.fontSize === params.fontSize &&\n\t\tpropCache.fontFamily === params.fontFamily &&\n\t\tpropCache.maxWidth === params.maxWidth &&\n\t\tpropCache.lineHeight === params.lineHeight\n\t) {\n\t\tparams.width = propCache.width;\n\t\tparams.height = propCache.height;\n\t} else {\n\t\t// Calculate text dimensions only once\n\n\t\t// Calculate width of first line (for comparison)\n\t\tparams.width = ctx.measureText(lines[0]).width;\n\n\t\t// Get width of longest line\n\t\tfor (let l = 1; l < lines.length; l += 1) {\n\t\t\tconst curWidth = ctx.measureText(lines[l]).width;\n\t\t\t// Ensure text's width is the width of its longest line\n\t\t\tif (curWidth > params.width) {\n\t\t\t\tparams.width = curWidth;\n\t\t\t}\n\t\t}\n\n\t\t// Save original font size\n\t\tconst originalSize = canvas.style.fontSize;\n\t\t// Temporarily set canvas font size to retrieve size in pixels\n\t\tcanvas.style.fontSize = params.fontSize;\n\t\t// Save text width and height in parameters object\n\t\tparams.height =\n\t\t\tparseFloat($.css(canvas, \"fontSize\")) * lines.length * params.lineHeight;\n\t\t// Reset font size to original size\n\t\tcanvas.style.fontSize = originalSize;\n\t}\n}\n\n// Wraps a string of text within a defined width\nfunction _wrapText(ctx: CanvasRenderingContext2D, params: JCanvasObject) {\n\tconst allText = String(params.text);\n\t// Maximum line width (optional)\n\tconst maxWidth = params.maxWidth;\n\t// Lines created by manual line breaks (\\n)\n\tconst manualLines = allText.split(\"\\n\");\n\t// All lines created manually and by wrapping\n\tlet allLines: string[] = [];\n\n\t// Loop through manually-broken lines\n\tfor (let l = 0; l < manualLines.length; l += 1) {\n\t\tconst text = manualLines[l];\n\t\t// Split line into list of words\n\t\tconst words = text.split(\" \");\n\t\tlet lines = [];\n\t\tlet line = \"\";\n\n\t\t// If text is short enough initially\n\t\t// Or, if the text consists of only one word\n\t\tif (\n\t\t\twords.length === 1 ||\n\t\t\t(maxWidth && ctx.measureText(text).width < maxWidth)\n\t\t) {\n\t\t\t// No need to wrap text\n\t\t\tlines = [text];\n\t\t} else {\n\t\t\t// Wrap lines\n\t\t\tfor (let w = 0; w < words.length; w += 1) {\n\t\t\t\t// Once line gets too wide, push word to next line\n\t\t\t\tif (maxWidth && ctx.measureText(line + words[w]).width > maxWidth) {\n\t\t\t\t\t// This check prevents empty lines from being created\n\t\t\t\t\tif (line !== \"\") {\n\t\t\t\t\t\tlines.push(line);\n\t\t\t\t\t}\n\t\t\t\t\t// Start new line and repeat process\n\t\t\t\t\tline = \"\";\n\t\t\t\t}\n\t\t\t\t// Add words to line until the line is too wide\n\t\t\t\tline += words[w];\n\t\t\t\t// Do not add a space after the last word\n\t\t\t\tif (w !== words.length - 1) {\n\t\t\t\t\tline += \" \";\n\t\t\t\t}\n\t\t\t}\n\t\t\t// The last word should always be pushed\n\t\t\tlines.push(line);\n\t\t}\n\t\t// Remove extra space at the end of each line\n\t\tallLines = allLines.concat(\n\t\t\tlines\n\t\t\t\t.join(\"\\n\")\n\t\t\t\t.replace(/((\\n))|($)/gi, \"$2\")\n\t\t\t\t.split(\"\\n\")\n\t\t);\n\t}\n\n\treturn allLines;\n}\n\n// Draws text on canvas\n$.fn.drawText = function drawText(args) {\n\tconst $canvases = this;\n\tconst constantCloseness = 500;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, drawText);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t// Set text-specific properties\n\t\tctx.textBaseline = params.baseline;\n\t\tctx.textAlign = params.align;\n\n\t\t// Set canvas font using given properties\n\t\t_setCanvasFont(canvas, ctx, params);\n\n\t\tlet lines: string[];\n\t\tif (params.maxWidth !== null) {\n\t\t\t// Wrap text using an internal function\n\t\t\tlines = _wrapText(ctx, params);\n\t\t} else {\n\t\t\t// Convert string of text to list of lines\n\t\t\tlines = params.text.toString().split(\"\\n\");\n\t\t}\n\n\t\t// Calculate text's width and height\n\t\t_measureText(canvas, ctx, params, lines);\n\n\t\t_transformShape(canvas, ctx, params, params.width, params.height);\n\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t// Adjust text position to accomodate different horizontal alignments\n\t\tlet x = params.x;\n\t\tif (params.align === \"left\" && params.width) {\n\t\t\tif (params.respectAlign) {\n\t\t\t\t// Realign text to the left if chosen\n\t\t\t\tparams.x += params.width / 2;\n\t\t\t} else {\n\t\t\t\t// Center text block by default\n\t\t\t\tx -= params.width / 2;\n\t\t\t}\n\t\t} else if (params.align === \"right\" && params.width) {\n\t\t\tif (params.respectAlign) {\n\t\t\t\t// Realign text to the right if chosen\n\t\t\t\tparams.x -= params.width / 2;\n\t\t\t} else {\n\t\t\t\t// Center text block by default\n\t\t\t\tx += params.width / 2;\n\t\t\t}\n\t\t}\n\n\t\tif (params.radius) {\n\t\t\tconst fontSize = parseFloat(params.fontSize);\n\n\t\t\t// Greater values move clockwise\n\t\t\tif (params.letterSpacing === null) {\n\t\t\t\tparams.letterSpacing = fontSize / constantCloseness;\n\t\t\t}\n\n\t\t\t// Loop through each line of text\n\t\t\tfor (let l = 0; l < lines.length; l += 1) {\n\t\t\t\tctx.save();\n\t\t\t\tctx.translate(params.x, params.y);\n\t\t\t\tlet line = lines[l];\n\t\t\t\tlet chars: string[];\n\t\t\t\tif (params.flipArcText) {\n\t\t\t\t\tchars = line.split(\"\");\n\t\t\t\t\tchars.reverse();\n\t\t\t\t\tline = chars.join(\"\");\n\t\t\t\t}\n\t\t\t\tconst nchars = line.length;\n\t\t\t\tctx.rotate(-(PI * params.letterSpacing * (nchars - 1)) / 2);\n\t\t\t\t// Loop through characters on each line\n\t\t\t\tfor (let c = 0; c < nchars; c += 1) {\n\t\t\t\t\tconst ch = line[c];\n\t\t\t\t\t// If character is not the first character\n\t\t\t\t\tif (c !== 0) {\n\t\t\t\t\t\t// Rotate character onto arc\n\t\t\t\t\t\tctx.rotate(PI * params.letterSpacing);\n\t\t\t\t\t}\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(0, -params.radius);\n\t\t\t\t\tif (params.flipArcText) {\n\t\t\t\t\t\tctx.scale(-1, -1);\n\t\t\t\t\t}\n\t\t\t\t\tctx.fillText(ch, 0, 0);\n\t\t\t\t\t// Prevent extra shadow created by stroke (but only when fill is present)\n\t\t\t\t\tif (params.fillStyle !== \"transparent\") {\n\t\t\t\t\t\tctx.shadowColor = \"transparent\";\n\t\t\t\t\t}\n\t\t\t\t\tif (params.strokeWidth !== 0) {\n\t\t\t\t\t\t// Only stroke if the stroke is not 0\n\t\t\t\t\t\tctx.strokeText(ch, 0, 0);\n\t\t\t\t\t}\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t\tparams.radius -= fontSize;\n\t\t\t\tparams.letterSpacing += fontSize / (constantCloseness * 2 * PI);\n\t\t\t\tctx.restore();\n\t\t\t}\n\t\t} else {\n\t\t\t// Draw each line of text separately\n\t\t\tfor (let l = 0; l < lines.length; l += 1) {\n\t\t\t\tconst line = lines[l];\n\t\t\t\t// Add line offset to center point, but subtract some to center everything\n\t\t\t\tconst y =\n\t\t\t\t\tparams.y +\n\t\t\t\t\t(l * (params.height || 0)) / lines.length -\n\t\t\t\t\t((lines.length - 1) * (params.height || 0)) / lines.length / 2;\n\n\t\t\t\tctx.shadowColor = params.shadowColor;\n\n\t\t\t\t// Fill & stroke text\n\t\t\t\tctx.fillText(line, x, y);\n\t\t\t\t// Prevent extra shadow created by stroke (but only when fill is present)\n\t\t\t\tif (params.fillStyle !== \"transparent\") {\n\t\t\t\t\tctx.shadowColor = \"transparent\";\n\t\t\t\t}\n\t\t\t\tif (params.strokeWidth !== 0) {\n\t\t\t\t\t// Only stroke if the stroke is not 0\n\t\t\t\t\tctx.strokeText(line, x, y);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Adjust bounding box according to text baseline\n\t\tlet y = 0;\n\t\tif (params.baseline === \"top\") {\n\t\t\ty += (params.height || 0) / 2;\n\t\t} else if (params.baseline === \"bottom\") {\n\t\t\ty -= (params.height || 0) / 2;\n\t\t}\n\n\t\t// Detect jCanvas events\n\t\tif (params._event) {\n\t\t\tconst nonNullWidth = params.width || 0;\n\t\t\tconst nonNullHeight = params.height || 0;\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(\n\t\t\t\tparams.x - nonNullWidth / 2,\n\t\t\t\tparams.y - nonNullHeight / 2 + y,\n\t\t\t\tnonNullWidth,\n\t\t\t\tnonNullHeight\n\t\t\t);\n\t\t\t_detectEvents(canvas, ctx, params);\n\t\t\t// Close path and configure masking\n\t\t\tctx.closePath();\n\t\t}\n\t\t_restoreTransform(ctx, params);\n\t\t// Cache jCanvas parameters object for efficiency\n\t\tif (params) {\n\t\t\tcaches.propCache = params;\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Measures text width/height using the given parameters\n$.fn.measureText = function measureText(args) {\n\tconst $canvases = this;\n\n\t// Attempt to retrieve layer\n\tconst params =\n\t\t$canvases.getLayer(args) || new jCanvasObject(args as JCanvasObject);\n\n\tconst canvas = $canvases[0];\n\tif (!_isCanvas(canvas)) {\n\t\treturn params;\n\t}\n\tconst ctx = _getContext(canvas);\n\tif (!ctx) {\n\t\treturn params;\n\t}\n\t// Set canvas font using given properties\n\t_setCanvasFont(canvas, ctx, params);\n\t// Calculate width and height of text\n\tlet lines: string[];\n\tif (params.maxWidth !== null) {\n\t\tlines = _wrapText(ctx, params);\n\t} else {\n\t\tlines = params.text.split(\"\\n\");\n\t}\n\t_measureText(canvas, ctx, params, lines);\n\n\treturn params;\n};\n\n/* Image API */\n\n// Draws image on canvas\n$.fn.drawImage = function drawImage(args) {\n\tconst $canvases = this;\n\tconst imageCache = caches.imageCache;\n\tlet img: HTMLImageElement | HTMLCanvasElement | null = null,\n\t\tsource: JCanvasObject[\"source\"];\n\n\t// Draw image function\n\tfunction draw(\n\t\tcanvas: HTMLCanvasElement,\n\t\tctx: CanvasRenderingContext2D,\n\t\tdata: JCanvasInternalData,\n\t\tparams: JCanvasObject,\n\t\tlayer: JCanvasObject | null\n\t) {\n\t\tif (!img) {\n\t\t\treturn;\n\t\t}\n\t\t// If width and sWidth are not defined, use image width\n\t\tif (params.width === null && params.sWidth === null) {\n\t\t\tparams.width = params.sWidth = img.width;\n\t\t}\n\t\t// If width and sHeight are not defined, use image height\n\t\tif (params.height === null && params.sHeight === null) {\n\t\t\tparams.height = params.sHeight = img.height;\n\t\t}\n\n\t\t// Ensure image layer's width and height are accurate\n\t\tif (layer) {\n\t\t\tlayer.width = params.width;\n\t\t\tlayer.height = params.height;\n\t\t}\n\n\t\tconst nonNullWidth = params.width || 0;\n\t\tconst nonNullHeight = params.height || 0;\n\n\t\t// Only crop image if all cropping properties are given\n\t\tif (\n\t\t\tparams.sWidth !== null &&\n\t\t\tparams.sHeight !== null &&\n\t\t\tparams.sx !== null &&\n\t\t\tparams.sy !== null\n\t\t) {\n\t\t\t// If width is not defined, use the given sWidth\n\t\t\tif (params.width === null) {\n\t\t\t\tparams.width = params.sWidth;\n\t\t\t}\n\t\t\t// If height is not defined, use the given sHeight\n\t\t\tif (params.height === null) {\n\t\t\t\tparams.height = params.sHeight;\n\t\t\t}\n\n\t\t\t// Optionally crop from top-left corner of region\n\t\t\tif (params.cropFromCenter) {\n\t\t\t\tparams.sx += params.sWidth / 2;\n\t\t\t\tparams.sy += params.sHeight / 2;\n\t\t\t}\n\n\t\t\t// Ensure cropped region does not escape image boundaries\n\n\t\t\t// Top\n\t\t\tif (params.sy - params.sHeight / 2 < 0) {\n\t\t\t\tparams.sy = params.sHeight / 2;\n\t\t\t}\n\t\t\t// Bottom\n\t\t\tif (params.sy + params.sHeight / 2 > img.height) {\n\t\t\t\tparams.sy = img.height - params.sHeight / 2;\n\t\t\t}\n\t\t\t// Left\n\t\t\tif (params.sx - params.sWidth / 2 < 0) {\n\t\t\t\tparams.sx = params.sWidth / 2;\n\t\t\t}\n\t\t\t// Right\n\t\t\tif (params.sx + params.sWidth / 2 > img.width) {\n\t\t\t\tparams.sx = img.width - params.sWidth / 2;\n\t\t\t}\n\n\t\t\t_transformShape(canvas, ctx, params, params.width, params.height);\n\t\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t\t// Draw image\n\t\t\tctx.drawImage(\n\t\t\t\timg,\n\t\t\t\tparams.sx - params.sWidth / 2,\n\t\t\t\tparams.sy - params.sHeight / 2,\n\t\t\t\tparams.sWidth,\n\t\t\t\tparams.sHeight,\n\t\t\t\tparams.x - params.width / 2,\n\t\t\t\tparams.y - params.height / 2,\n\t\t\t\tparams.width,\n\t\t\t\tparams.height\n\t\t\t);\n\t\t} else {\n\t\t\t// Show entire image if no crop region is defined\n\n\t\t\t_transformShape(canvas, ctx, params, params.width, params.height);\n\t\t\t_setGlobalProps(canvas, ctx, params);\n\n\t\t\t// Draw image on canvas\n\t\t\tctx.drawImage(\n\t\t\t\timg,\n\t\t\t\tparams.x - nonNullWidth / 2,\n\t\t\t\tparams.y - nonNullHeight / 2,\n\t\t\t\tnonNullWidth,\n\t\t\t\tnonNullHeight\n\t\t\t);\n\t\t}\n\n\t\t// Draw invisible rectangle to allow for events and masking\n\t\tctx.beginPath();\n\t\tctx.rect(\n\t\t\tparams.x - nonNullWidth / 2,\n\t\t\tparams.y - nonNullHeight / 2,\n\t\t\tnonNullWidth,\n\t\t\tnonNullHeight\n\t\t);\n\t\t// Check for jCanvas events\n\t\t_detectEvents(canvas, ctx, params);\n\t\t// Close path and configure masking\n\t\tctx.closePath();\n\t\t_restoreTransform(ctx, params);\n\t\t_enableMasking(ctx, data, params);\n\t}\n\t// On load function\n\tfunction onload(\n\t\tcanvas: HTMLCanvasElement,\n\t\tctx: CanvasRenderingContext2D,\n\t\tdata: JCanvasInternalData,\n\t\tparams: JCanvasObject,\n\t\tlayer: JCanvasObject | null\n\t) {\n\t\treturn function () {\n\t\t\tconst $canvas = $(canvas);\n\t\t\tdraw(canvas, ctx, data, params, layer);\n\t\t\tif (params.layer && layer instanceof jCanvasLayer) {\n\t\t\t\t// Trigger 'load' event for layers\n\t\t\t\t_triggerLayerEvent($canvas, data, layer, \"load\");\n\t\t\t} else if (params.load) {\n\t\t\t\t// Run 'load' callback for non-layers\n\t\t\t\tparams.load.call($canvas[0], layer);\n\t\t\t}\n\t\t\t// Continue drawing successive layers after this image layer has loaded\n\t\t\tif (params.layer && layer) {\n\t\t\t\t// Store list of previous masks for each layer\n\t\t\t\tlayer._masks = data.transforms.masks.slice(0);\n\t\t\t\tif (params._next) {\n\t\t\t\t\t// Draw successive layers\n\t\t\t\t\tconst complete = data.drawLayersComplete;\n\t\t\t\t\tdelete data.drawLayersComplete;\n\t\t\t\t\t$canvas.drawLayers({\n\t\t\t\t\t\tclear: false,\n\t\t\t\t\t\tresetFire: true,\n\t\t\t\t\t\tindex: params._next,\n\t\t\t\t\t\tcomplete: complete,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\t\tconst params = _getParamsObject(args);\n\t\tconst layer = _addLayer(canvas, params, args, drawImage);\n\t\tif (!params.visible) {\n\t\t\tcontinue;\n\t\t}\n\t\t// Cache the given source\n\t\tsource = params.source;\n\n\t\tif (\n\t\t\tsource instanceof HTMLImageElement ||\n\t\t\tsource instanceof HTMLCanvasElement\n\t\t) {\n\t\t\t// Use image or canvas element if given\n\t\t\timg = source;\n\t\t} else if (source) {\n\t\t\tconst cachedImg = imageCache[source];\n\t\t\tif (cachedImg?.complete) {\n\t\t\t\t// Get the image element from the cache if possible\n\t\t\t\timg = cachedImg;\n\t\t\t} else {\n\t\t\t\t// Otherwise, get the image from the given source URL\n\t\t\t\timg = new Image();\n\t\t\t\t// If source URL is not a data URL\n\t\t\t\tif (!source.match(/^data:/i)) {\n\t\t\t\t\t// Set crossOrigin for this image\n\t\t\t\t\timg.crossOrigin = params.crossOrigin;\n\t\t\t\t}\n\t\t\t\timg.src = source;\n\t\t\t\t// Save image in cache for improved performance\n\t\t\t\timageCache[source] = img;\n\t\t\t}\n\t\t}\n\n\t\tif (img) {\n\t\t\tif (\n\t\t\t\t(img instanceof HTMLImageElement && img.complete) ||\n\t\t\t\timg instanceof HTMLCanvasElement\n\t\t\t) {\n\t\t\t\t// Draw image if already loaded\n\t\t\t\tonload(canvas, ctx, data, params, layer)();\n\t\t\t} else {\n\t\t\t\t// Otherwise, draw image when it loads\n\t\t\t\timg.onload = onload(canvas, ctx, data, params, layer);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Creates a canvas pattern object\n$.fn.createPattern = function createPattern(args) {\n\tconst $canvases = this;\n\tlet img: HTMLCanvasElement | HTMLImageElement;\n\tlet pattern: CanvasPattern | null = null;\n\n\t// Function to be called when pattern loads\n\tfunction onload(ctx: CanvasRenderingContext2D, params: JCanvasObject) {\n\t\t// Create pattern\n\t\tpattern = ctx.createPattern(img, params.repeat);\n\t\t// Run callback function if defined\n\t\tif (params.load && pattern) {\n\t\t\tparams.load.call($canvases[0], pattern);\n\t\t}\n\t}\n\n\tconst canvas = $canvases[0];\n\tif (!_isCanvas(canvas)) {\n\t\treturn null;\n\t}\n\tconst ctx = _getContext(canvas);\n\tif (!ctx) {\n\t\treturn null;\n\t}\n\tconst params = _getParamsObject(args);\n\n\t// Cache the given source\n\tconst source = params.source;\n\n\t// Draw when image is loaded (if load() callback function is defined)\n\n\tif (isFunction(source)) {\n\t\t// Draw pattern using function if given\n\n\t\timg = document.createElement(\"canvas\");\n\t\timg.width = params.width || 0;\n\t\timg.height = params.height || 0;\n\t\tconst imgCtx = _getContext(img);\n\t\tsource.call(img, imgCtx);\n\t\tonload(ctx, params);\n\t} else {\n\t\t// Otherwise, draw pattern using source image\n\n\t\tif (\n\t\t\tsource instanceof HTMLImageElement ||\n\t\t\tsource instanceof HTMLCanvasElement\n\t\t) {\n\t\t\t// Use image element if given\n\t\t\timg = source;\n\t\t} else {\n\t\t\t// Use URL if given to get the image\n\t\t\timg = new Image();\n\t\t\t// If source URL is not a data URL\n\t\t\tif (!source.match(/^data:/i)) {\n\t\t\t\t// Set crossOrigin for this image\n\t\t\t\timg.crossOrigin = params.crossOrigin;\n\t\t\t}\n\t\t\timg.src = source;\n\t\t}\n\n\t\t// Create pattern if already loaded\n\t\tif (\n\t\t\t(img instanceof HTMLImageElement && img.complete) ||\n\t\t\timg instanceof HTMLCanvasElement\n\t\t) {\n\t\t\tonload(ctx, params);\n\t\t} else {\n\t\t\timg.onload = () => onload(ctx, params);\n\t\t}\n\t}\n\treturn pattern;\n};\n\n// Creates a canvas gradient object\n$.fn.createGradient = function createGradient(args) {\n\tconst $canvases = this;\n\tlet gradient: CanvasGradient | null = null;\n\tconst stops: (number | null)[] = [];\n\n\tconst params = _getParamsObject(args);\n\tconst canvas = $canvases[0];\n\tif (!_isCanvas(canvas)) {\n\t\treturn null;\n\t}\n\tconst ctx = _getContext(canvas);\n\tif (!ctx) {\n\t\treturn null;\n\t}\n\t// Gradient coordinates must be defined\n\tparams.x1 = params.x1 || 0;\n\tparams.y1 = params.y1 || 0;\n\tparams.x2 = params.x2 || 0;\n\tparams.y2 = params.y2 || 0;\n\n\tif (params.r1 !== null && params.r2 !== null) {\n\t\t// Create radial gradient if chosen\n\t\tgradient = ctx.createRadialGradient(\n\t\t\tparams.x1,\n\t\t\tparams.y1,\n\t\t\tparams.r1,\n\t\t\tparams.x2,\n\t\t\tparams.y2,\n\t\t\tparams.r2\n\t\t);\n\t} else {\n\t\t// Otherwise, create a linear gradient by default\n\t\tgradient = ctx.createLinearGradient(\n\t\t\tparams.x1,\n\t\t\tparams.y1,\n\t\t\tparams.x2,\n\t\t\tparams.y2\n\t\t);\n\t}\n\n\t// Count number of color stops\n\tfor (\n\t\tlet i = 1;\n\t\tparams[(\"c\" + i) as keyof typeof params] !== undefined;\n\t\ti += 1\n\t) {\n\t\tif (params[(\"s\" + i) as keyof typeof params] !== undefined) {\n\t\t\tstops.push(params[(\"s\" + i) as keyof typeof params]);\n\t\t} else {\n\t\t\tstops.push(null);\n\t\t}\n\t}\n\tconst nstops = stops.length;\n\n\t// Define start stop if not already defined\n\tif (stops[0] === null) {\n\t\tstops[0] = 0;\n\t}\n\t// Define end stop if not already defined\n\tif (stops[nstops - 1] === null) {\n\t\tstops[nstops - 1] = 1;\n\t}\n\n\t// Loop through color stops to fill in the blanks\n\tfor (let i = 0; i < nstops; i += 1) {\n\t\t// A progression, in this context, is defined as all of the color stops between and including two known color stops\n\t\tlet p: number = 0;\n\t\tlet start: number | null = null;\n\t\tlet end: number | null = null;\n\t\t// Number of stops in current progression\n\t\tlet n = 1;\n\t\tif (stops[i] !== null) {\n\t\t\t// Start a new progression if stop is a number\n\n\t\t\t// Current iteration in current progression\n\t\t\tp = 0;\n\t\t\tstart = stops[i];\n\n\t\t\t// Look ahead to find end stop\n\t\t\tlet a;\n\t\t\tfor (a = i + 1; a < nstops; a += 1) {\n\t\t\t\tif (stops[a] !== null) {\n\t\t\t\t\t// If this future stop is a number, make it the end stop for this progression\n\t\t\t\t\tend = stops[a];\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t// Otherwise, keep looking ahead\n\t\t\t\t\tn += 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Ensure start stop is not greater than end stop\n\t\t\tif (start! > end!) {\n\t\t\t\tstops[a] = stops[i];\n\t\t\t}\n\t\t} else if (stops[i] === null) {\n\t\t\t// Calculate stop if not initially given\n\t\t\tp += 1;\n\t\t\tstops[i] = start! + p * ((end! - start!) / n);\n\t\t}\n\t\t// Add color stop to gradient object\n\t\tconst stop = stops[i];\n\t\tif (stop !== null) {\n\t\t\tgradient.addColorStop(\n\t\t\t\tstop,\n\t\t\t\tparams[(\"c\" + (i + 1)) as keyof typeof params]\n\t\t\t);\n\t\t}\n\t}\n\treturn gradient;\n};\n\n// Manipulates pixels on the canvas\n$.fn.setPixels = function setPixels(args) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tconst canvasData = _getCanvasData(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst params = _getParamsObject(args);\n\t\t_addLayer(canvas, params, args, setPixels);\n\t\t_transformShape(canvas, ctx, params, params.width, params.height);\n\n\t\t// Use entire canvas of x, y, width, or height is not defined\n\t\tif (params.width === null || params.height === null) {\n\t\t\tparams.width = canvas.width;\n\t\t\tparams.height = canvas.height;\n\t\t\tparams.x = params.width / 2;\n\t\t\tparams.y = params.height / 2;\n\t\t}\n\n\t\tif (params.width !== 0 && params.height !== 0) {\n\t\t\t// Only set pixels if width and height are not zero\n\n\t\t\tconst imgData = ctx.getImageData(\n\t\t\t\t(params.x - params.width / 2) * canvasData.pixelRatio,\n\t\t\t\t(params.y - params.height / 2) * canvasData.pixelRatio,\n\t\t\t\tparams.width * canvasData.pixelRatio,\n\t\t\t\tparams.height * canvasData.pixelRatio\n\t\t\t);\n\t\t\tconst pixelData = imgData.data;\n\t\t\tconst len = pixelData.length;\n\n\t\t\t// Loop through pixels with the \"each\" callback function\n\t\t\tif (params.each) {\n\t\t\t\tfor (let i = 0; i < len; i += 4) {\n\t\t\t\t\tconst px = {\n\t\t\t\t\t\tr: pixelData[i],\n\t\t\t\t\t\tg: pixelData[i + 1],\n\t\t\t\t\t\tb: pixelData[i + 2],\n\t\t\t\t\t\ta: pixelData[i + 3],\n\t\t\t\t\t};\n\t\t\t\t\tparams.each.call(canvas, px, params);\n\t\t\t\t\tpixelData[i] = px.r;\n\t\t\t\t\tpixelData[i + 1] = px.g;\n\t\t\t\t\tpixelData[i + 2] = px.b;\n\t\t\t\t\tpixelData[i + 3] = px.a;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Put pixels on canvas\n\t\t\tctx.putImageData(\n\t\t\t\timgData,\n\t\t\t\t(params.x - params.width / 2) * canvasData.pixelRatio,\n\t\t\t\t(params.y - params.height / 2) * canvasData.pixelRatio\n\t\t\t);\n\t\t\t// Restore transformation\n\t\t\tctx.restore();\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Retrieves canvas image as data URL\n$.fn.getCanvasImage = function getCanvasImage(type, quality) {\n\tconst $canvases = this;\n\tif ($canvases.length !== 0) {\n\t\tconst canvas = $canvases[0];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\treturn null;\n\t\t}\n\t\t// JPEG quality defaults to 1\n\t\tif (quality === undefined) {\n\t\t\tquality = 1;\n\t\t}\n\t\treturn canvas.toDataURL(\"image/\" + type, quality);\n\t}\n\treturn null;\n};\n\n// Scales canvas based on the device's pixel ratio\n$.fn.detectPixelRatio = function detectPixelRatio(callback) {\n\tconst $canvases = this;\n\n\tfor (let e = 0; e < $canvases.length; e += 1) {\n\t\t// Get canvas and its associated data\n\t\tconst canvas = $canvases[e];\n\t\tif (!_isCanvas(canvas)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst ctx = _getContext(canvas);\n\t\tif (!ctx) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = _getCanvasData(canvas);\n\n\t\t// If canvas has not already been scaled with this method\n\t\tif (!data.scaled) {\n\t\t\t// Determine device pixel ratios\n\t\t\tconst ratio = window.devicePixelRatio || 1;\n\n\t\t\tif (ratio !== 1) {\n\t\t\t\t// Scale canvas relative to ratio\n\n\t\t\t\t// Get the current canvas dimensions for future use\n\t\t\t\tconst oldWidth = canvas.width;\n\t\t\t\tconst oldHeight = canvas.height;\n\n\t\t\t\t// Resize canvas relative to the determined ratio\n\t\t\t\tcanvas.width = oldWidth * ratio;\n\t\t\t\tcanvas.height = oldHeight * ratio;\n\n\t\t\t\t// Scale canvas back to original dimensions via CSS\n\t\t\t\tcanvas.style.width = oldWidth + \"px\";\n\t\t\t\tcanvas.style.height = oldHeight + \"px\";\n\n\t\t\t\t// Scale context to counter the manual scaling of canvas\n\t\t\t\tctx.scale(ratio, ratio);\n\t\t\t}\n\n\t\t\t// Set pixel ratio on canvas data object\n\t\t\tdata.pixelRatio = ratio;\n\t\t\t// Ensure that this method can only be called once for any given canvas\n\t\t\tdata.scaled = true;\n\n\t\t\t// Call the given callback function with the ratio as its only argument\n\t\t\tif (callback) {\n\t\t\t\tcallback.call(canvas, ratio);\n\t\t\t}\n\t\t}\n\t}\n\treturn $canvases;\n};\n\n// Clears the jCanvas cache\njCanvas.clearCache = function clearCache() {\n\tfor (const cacheName in caches) {\n\t\tif (Object.prototype.hasOwnProperty.call(caches, cacheName)) {\n\t\t\tcaches[cacheName as keyof typeof caches] = {};\n\t\t}\n\t}\n};\n\n// Export jCanvas functions\nextendObject(jCanvas, {\n\tdefaults: defaults,\n\tsetGlobalProps: _setGlobalProps,\n\ttransformShape: _transformShape,\n\tdetectEvents: _detectEvents,\n\tclosePath: _closePath,\n\tsetCanvasFont: _setCanvasFont,\n\tmeasureText: _measureText,\n});\n$.jCanvas = jCanvas;\n$.jCanvasObject = jCanvasObject;\n"],"names":["extendObject","inArray","$","typeOf","operand","isPlainObject","PI","round","abs","sin","cos","atan2","jQueryEventFix","maps","caches","baseTransforms","css","tangibleEvents","jCanvas","jCanvasDefaults","defaults","jCanvasObject","args","jCanvasLayer","canvas","params","_getParamsObject","isString","isFunction","isNumeric","_isCanvas","element","_getContext","_coerceNumericProps","props","propName","propValue","_cloneTransforms","transforms","_saveCanvas","ctx","data","_restoreCanvas","lastTransform","_setStyle","styleName","styleValue","_setGlobalProps","_enableMasking","_restoreTransform","_closePath","_getCanvasData","_transformShape","_canvas","width","height","_rotateCanvas","_scaleCanvas","_translateCanvas","plugin","self","$canvases","e","_addLayer","JCanvasInternalData","dataCache","_addLayerEvents","$canvas","layer","eventName","_addExplicitLayerEvent","shouldRedraw","dragLayer","_triggerLayerEvent","l","_addLayerEvent","_enableDrag","dragHelperEvents","i","_updateLayerName","nameMap","_updateLayerGroups","groupMap","index","g","groupName","group","eventHooks","callback","matching","layers","layerId","idType","layerIndex","layerPattern","layerName","groupId","groupPattern","groups","propType","_getIntersectingLayer","mask","m","_drawLayer","nextLayerIndex","_handleLayerDrag","eventType","drag","dragGroups","newX","newY","_setCursor","cursor","_resetCursor","_runEventCallback","callbacks","arg","_layerCanFireEvent","isImageLayer","lastIndex","eventCache","lastLayer","_getMouseEventName","method","newLayer","_showProps","obj","p","cssProp","_hideProps","reset","_parseEndValues","endValues","subPropName","subPropValue","_removeSubPropAliases","_normalizeColor","color","headElem","originalColor","normalizedColor","_convertColorToRgbArray","rgbMatches","multiple","_blendColors","color1","color2","percentage","r1","g1","b1","a1","r2","g2","b2","a2","r","b","a","complete","step","now","fx","parts","hidden","duration","clearQueue","_supportColorProps","tween","_getTouchEventName","_createEvent","helperEventName","touchEventName","eventCallback","event","_createEvents","eventNames","n","_detectEvents","intersects","x","y","angle","originalEvent","touches","offset","draw","fn","clearCanvas","saveCanvas","restoreCanvas","rotateCanvas","scaleCanvas","translateCanvas","drawRect","nonNullWidth","nonNullHeight","x1","y1","_getCoterminal","_getConicX","radiusX","_getConicY","radiusY","_getConicOffsets","path","offsetX","offsetY","angleDiff","pathX","pathY","pathStartAngle","pathEndAngle","_drawArc","x2","y2","_addStartArrow","x3","y3","x4","y4","_addEndArrow","_drawEllipse","drawArc","drawEllipse","drawPolygon","dtheta","hdtheta","theta","apothem","drawSlice","dx","dy","_addArrow","leftX","leftY","rightX","rightY","_drawLine","lx","ly","drawLine","_drawQuadratic","lcx","lcy","drawQuadratic","_drawBezier","lc","lcx1","lcy1","lcx2","lcy2","drawBezier","_getVectorX","length","_getVectorY","_drawVector","drawVector","drawPath","lp","_setCanvasFont","_measureText","lines","propCache","curWidth","originalSize","_wrapText","allText","maxWidth","manualLines","allLines","text","words","line","w","drawText","constantCloseness","fontSize","chars","nchars","c","ch","drawImage","imageCache","img","source","onload","cachedImg","pattern","imgCtx","gradient","stops","nstops","start","end","stop","setPixels","canvasData","imgData","pixelData","len","px","type","quality","ratio","oldWidth","oldHeight","cacheName"],"mappings":"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"}